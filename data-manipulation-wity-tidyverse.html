<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Data Manipulation wity tidyverse | R for Data Journalism</title>
  <meta name="description" content="For my Class teaching how to make data news reports" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Data Manipulation wity tidyverse | R for Data Journalism" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="For my Class teaching how to make data news reports" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Data Manipulation wity tidyverse | R for Data Journalism" />
  
  <meta name="twitter:description" content="For my Class teaching how to make data news reports" />
  

<meta name="author" content="HSIEH, JI-LUNG" />


<meta name="date" content="2023-02-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="使用基礎r套件.html"/>
<link rel="next" href="text-processing.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.9/grViz.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.25/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for Data Journalism</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="part"><span><b>I R BASIC</b></span></li>
<li class="chapter" data-level="2" data-path="basic.html"><a href="basic.html"><i class="fa fa-check"></i><b>2</b> R Basic</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basic.html"><a href="basic.html#使用rstudio"><i class="fa fa-check"></i><b>2.1</b> 使用RStudio</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="basic.html"><a href="basic.html#rstudio介面簡介"><i class="fa fa-check"></i><b>2.1.1</b> RStudio介面簡介</a></li>
<li class="chapter" data-level="2.1.2" data-path="basic.html"><a href="basic.html#用rmarkdown來撰寫r"><i class="fa fa-check"></i><b>2.1.2</b> 用RMarkdown來撰寫R</a></li>
<li class="chapter" data-level="2.1.3" data-path="basic.html"><a href="basic.html#安裝並載入第三方套件"><i class="fa fa-check"></i><b>2.1.3</b> 安裝並載入第三方套件</a></li>
<li class="chapter" data-level="2.1.4" data-path="basic.html"><a href="basic.html#程式碼註解"><i class="fa fa-check"></i><b>2.1.4</b> 程式碼註解</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="basic.html"><a href="basic.html#第一次資料嘗試"><i class="fa fa-check"></i><b>2.2</b> 第一次資料嘗試</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="basic.html"><a href="basic.html#直接從網路載入內政部開放資料"><i class="fa fa-check"></i><b>2.2.1</b> 直接從網路載入內政部開放資料</a></li>
<li class="chapter" data-level="2.2.2" data-path="basic.html"><a href="basic.html#獲取ubike即時資料"><i class="fa fa-check"></i><b>2.2.2</b> 獲取ubike即時資料</a></li>
<li class="chapter" data-level="2.2.3" data-path="basic.html"><a href="basic.html#讀取台北住宅竊盜點位資料"><i class="fa fa-check"></i><b>2.2.3</b> 讀取台北住宅竊盜點位資料</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="basic.html"><a href="basic.html#r-qa"><i class="fa fa-check"></i><b>2.3</b> R Q&amp;A</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="basic.html"><a href="basic.html#編碼與設定語系"><i class="fa fa-check"></i><b>2.3.1</b> 編碼與設定語系</a></li>
<li class="chapter" data-level="2.3.2" data-path="basic.html"><a href="basic.html#rmdr-notebook無法儲存"><i class="fa fa-check"></i><b>2.3.2</b> RMD/R Notebook無法儲存</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-basic.html"><a href="r-basic.html"><i class="fa fa-check"></i><b>3</b> R Basic</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-basic.html"><a href="r-basic.html#r-syntax"><i class="fa fa-check"></i><b>3.1</b> R Syntax</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="r-basic.html"><a href="r-basic.html#assignment"><i class="fa fa-check"></i><b>3.1.1</b> Assignment</a></li>
<li class="chapter" data-level="3.1.2" data-path="r-basic.html"><a href="r-basic.html#comments-註解"><i class="fa fa-check"></i><b>3.1.2</b> Comments 註解</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="r-basic.html"><a href="r-basic.html#vector"><i class="fa fa-check"></i><b>3.2</b> Vector</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="r-basic.html"><a href="r-basic.html#creating-vectors"><i class="fa fa-check"></i><b>3.2.1</b> Creating vectors</a></li>
<li class="chapter" data-level="3.2.2" data-path="r-basic.html"><a href="r-basic.html#viewing"><i class="fa fa-check"></i><b>3.2.2</b> Viewing</a></li>
<li class="chapter" data-level="3.2.3" data-path="r-basic.html"><a href="r-basic.html#subsetting-filtering"><i class="fa fa-check"></i><b>3.2.3</b> Subsetting, filtering</a></li>
<li class="chapter" data-level="3.2.4" data-path="r-basic.html"><a href="r-basic.html#deleting"><i class="fa fa-check"></i><b>3.2.4</b> Deleting</a></li>
<li class="chapter" data-level="3.2.5" data-path="r-basic.html"><a href="r-basic.html#concatinating"><i class="fa fa-check"></i><b>3.2.5</b> Concatinating</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="r-basic.html"><a href="r-basic.html#calculating-with-vectors"><i class="fa fa-check"></i><b>3.3</b> Calculating with vectors</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="r-basic.html"><a href="r-basic.html#arithmetic-operations"><i class="fa fa-check"></i><b>3.3.1</b> Arithmetic operations</a></li>
<li class="chapter" data-level="3.3.2" data-path="r-basic.html"><a href="r-basic.html#logic-comparisons"><i class="fa fa-check"></i><b>3.3.2</b> Logic comparisons</a></li>
<li class="chapter" data-level="3.3.3" data-path="r-basic.html"><a href="r-basic.html#subsetting-by-logic-comparisons"><i class="fa fa-check"></i><b>3.3.3</b> Subsetting by logic comparisons</a></li>
<li class="chapter" data-level="3.3.4" data-path="r-basic.html"><a href="r-basic.html#sorting-and-ordering"><i class="fa fa-check"></i><b>3.3.4</b> Sorting and ordering</a></li>
<li class="chapter" data-level="3.3.5" data-path="r-basic.html"><a href="r-basic.html#built-in-math-functions"><i class="fa fa-check"></i><b>3.3.5</b> Built-in math functions</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="r-basic.html"><a href="r-basic.html#data-types"><i class="fa fa-check"></i><b>3.4</b> Data types</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="r-basic.html"><a href="r-basic.html#checking-data-type"><i class="fa fa-check"></i><b>3.4.1</b> Checking data type</a></li>
<li class="chapter" data-level="3.4.2" data-path="r-basic.html"><a href="r-basic.html#converting-data-type"><i class="fa fa-check"></i><b>3.4.2</b> Converting data type</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="r-basic.html"><a href="r-basic.html#character-operations"><i class="fa fa-check"></i><b>3.5</b> Character operations</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dataframe.html"><a href="dataframe.html"><i class="fa fa-check"></i><b>4</b> Dataframe</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dataframe.html"><a href="dataframe.html#基本操作"><i class="fa fa-check"></i><b>4.1</b> 基本操作</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="dataframe.html"><a href="dataframe.html#產生新的dataframe"><i class="fa fa-check"></i><b>4.1.1</b> 產生新的Dataframe</a></li>
<li class="chapter" data-level="4.1.2" data-path="dataframe.html"><a href="dataframe.html#觀察dataframe"><i class="fa fa-check"></i><b>4.1.2</b> 觀察dataframe</a></li>
<li class="chapter" data-level="4.1.3" data-path="dataframe.html"><a href="dataframe.html#操作dataframe"><i class="fa fa-check"></i><b>4.1.3</b> 操作dataframe</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="dataframe.html"><a href="dataframe.html#簡易繪圖"><i class="fa fa-check"></i><b>4.2</b> 簡易繪圖</a></li>
<li class="chapter" data-level="4.3" data-path="dataframe.html"><a href="dataframe.html#基本操作使用dplyr"><i class="fa fa-check"></i><b>4.3</b> 基本操作：使用dplyr</a></li>
<li class="chapter" data-level="4.4" data-path="dataframe.html"><a href="dataframe.html#tibble-data_frame-data.frame"><i class="fa fa-check"></i><b>4.4</b> tibble, data_frame, data.frame</a></li>
<li class="chapter" data-level="4.5" data-path="dataframe.html"><a href="dataframe.html#database---sqlite"><i class="fa fa-check"></i><b>4.5</b> Database - SQLite</a></li>
</ul></li>
<li class="part"><span><b>II DATA MANIPULATION</b></span></li>
<li class="chapter" data-level="5" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html"><i class="fa fa-check"></i><b>5</b> 使用基礎R套件</a>
<ul>
<li class="chapter" data-level="5.1" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#案例產假支薪跨國跨時比較"><i class="fa fa-check"></i><b>5.1</b> 案例：產假支薪跨國跨時比較</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#reading-.xlsx-by-readxl-package"><i class="fa fa-check"></i><b>5.1.1</b> Reading .xlsx by readxl package</a></li>
<li class="chapter" data-level="5.1.2" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#previewing-data-by-view-class-dim-str-summary-and-names"><i class="fa fa-check"></i><b>5.1.2</b> Previewing data by <code>View()</code>, <code>class()</code>, <code>dim()</code>, <code>str()</code>, <code>summary()</code> and <code>names()</code></a></li>
<li class="chapter" data-level="5.1.3" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#select-variables"><i class="fa fa-check"></i><b>5.1.3</b> Select variables</a></li>
<li class="chapter" data-level="5.1.4" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#check-replace-nas"><i class="fa fa-check"></i><b>5.1.4</b> Check &amp; Replace NAs</a></li>
<li class="chapter" data-level="5.1.5" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#filtering-data"><i class="fa fa-check"></i><b>5.1.5</b> Filtering data</a></li>
<li class="chapter" data-level="5.1.6" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#plotting"><i class="fa fa-check"></i><b>5.1.6</b> Plotting</a></li>
<li class="chapter" data-level="5.1.7" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#practice02_1_1-plotting-more"><i class="fa fa-check"></i><b>5.1.7</b> Practice02_1_1 Plotting more</a></li>
<li class="chapter" data-level="5.1.8" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#practice02_2_2-selecting-and-filtering-by-dplyr-i"><i class="fa fa-check"></i><b>5.1.8</b> Practice02_2_2 selecting and filtering by dplyr I</a></li>
<li class="chapter" data-level="5.1.9" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#more-clean-version"><i class="fa fa-check"></i><b>5.1.9</b> (More) Clean version</a></li>
<li class="chapter" data-level="5.1.10" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#more-the-fittest-version-to-compute-staysame"><i class="fa fa-check"></i><b>5.1.10</b> (More) The fittest version to compute staySame</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#計數與樞紐台北住宅竊盜點位"><i class="fa fa-check"></i><b>5.2</b> 計數與樞紐：台北住宅竊盜點位</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#讀取檔案"><i class="fa fa-check"></i><b>5.2.1</b> 讀取檔案</a></li>
<li class="chapter" data-level="5.2.2" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#查看資料內容"><i class="fa fa-check"></i><b>5.2.2</b> 查看資料內容</a></li>
<li class="chapter" data-level="5.2.3" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#觀察資料維度-1"><i class="fa fa-check"></i><b>5.2.3</b> 觀察資料維度</a></li>
<li class="chapter" data-level="5.2.4" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#觀察變數名稱"><i class="fa fa-check"></i><b>5.2.4</b> 觀察變數名稱</a></li>
<li class="chapter" data-level="5.2.5" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#萃取所需新變項"><i class="fa fa-check"></i><b>5.2.5</b> 萃取所需新變項</a></li>
<li class="chapter" data-level="5.2.6" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#iv.-樞紐分析計數加總與彙整"><i class="fa fa-check"></i><b>5.2.6</b> IV. 樞紐分析：計數、加總與彙整。</a></li>
<li class="chapter" data-level="5.2.7" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#方法一counting-by-table"><i class="fa fa-check"></i><b>5.2.7</b> 方法一：Counting by <code>table()</code></a></li>
<li class="chapter" data-level="5.2.8" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#方法二counting-by-tapply"><i class="fa fa-check"></i><b>5.2.8</b> 方法二：Counting by <code>tapply()</code></a></li>
<li class="chapter" data-level="5.2.9" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#v.-依照變數值篩選資料"><i class="fa fa-check"></i><b>5.2.9</b> V. 依照變數值篩選資料</a></li>
<li class="chapter" data-level="5.2.10" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#vi.-雙變數樞紐分析"><i class="fa fa-check"></i><b>5.2.10</b> VI. 雙變數樞紐分析</a></li>
<li class="chapter" data-level="5.2.11" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#vii.-繪圖-plotting"><i class="fa fa-check"></i><b>5.2.11</b> VII. 繪圖 Plotting</a></li>
<li class="chapter" data-level="5.2.12" data-path="使用基礎r套件.html"><a href="使用基礎r套件.html#option-視覺化殘差分析"><i class="fa fa-check"></i><b>5.2.12</b> (Option) 視覺化殘差分析</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html"><i class="fa fa-check"></i><b>6</b> Data Manipulation wity tidyverse</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#base-to-dplyr-tp-theft"><i class="fa fa-check"></i><b>6.1</b> base to dplyr: TP Theft</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#reading-data"><i class="fa fa-check"></i><b>6.1.1</b> Reading data</a></li>
<li class="chapter" data-level="6.1.2" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#cleaning-data-i"><i class="fa fa-check"></i><b>6.1.2</b> Cleaning data I</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#cleaning-data-ii"><i class="fa fa-check"></i><b>6.1.3</b> Cleaning data II</a></li>
<li class="chapter" data-level="6.1.4" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#long-to-wide-form"><i class="fa fa-check"></i><b>6.1.4</b> Long to wide form</a></li>
<li class="chapter" data-level="6.1.5" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#setting-time-as-row.name-for-mosaicplot"><i class="fa fa-check"></i><b>6.1.5</b> Setting time as row.name for mosaicplot</a></li>
<li class="chapter" data-level="6.1.6" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#clean-version"><i class="fa fa-check"></i><b>6.1.6</b> Clean version</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#空值na處理"><i class="fa fa-check"></i><b>6.2</b> 空值（NA）處理</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#表格重整政府預算"><i class="fa fa-check"></i><b>6.2.1</b> 表格重整：政府預算</a></li>
<li class="chapter" data-level="6.2.2" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#對齊資料世界各國疫苗接種比例"><i class="fa fa-check"></i><b>6.2.2</b> 對齊資料。世界各國疫苗接種比例</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#categorical"><i class="fa fa-check"></i><b>6.3</b> 類別資料分析</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#清理資料"><i class="fa fa-check"></i><b>6.3.1</b> 清理資料</a></li>
<li class="chapter" data-level="6.3.2" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#尺度轉類別指標"><i class="fa fa-check"></i><b>6.3.2</b> 尺度轉類別指標</a></li>
<li class="chapter" data-level="6.3.3" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#cross-tabulating"><i class="fa fa-check"></i><b>6.3.3</b> Cross-tabulating</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#時間軸的視覺化"><i class="fa fa-check"></i><b>6.4</b> 時間軸的視覺化</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#文字轉時間"><i class="fa fa-check"></i><b>6.4.1</b> 文字轉時間</a></li>
<li class="chapter" data-level="6.4.2" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#時間作為機率分佈x軸"><i class="fa fa-check"></i><b>6.4.2</b> 時間作為機率分佈X軸</a></li>
<li class="chapter" data-level="6.4.3" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#逐月統計資料"><i class="fa fa-check"></i><b>6.4.3</b> 逐月統計資料</a></li>
<li class="chapter" data-level="6.4.4" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#逐日統計資料佳"><i class="fa fa-check"></i><b>6.4.4</b> 逐日統計資料（佳）</a></li>
<li class="chapter" data-level="6.4.5" data-path="data-manipulation-wity-tidyverse.html"><a href="data-manipulation-wity-tidyverse.html#每日逐時資料"><i class="fa fa-check"></i><b>6.4.5</b> 每日逐時資料</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="text-processing.html"><a href="text-processing.html"><i class="fa fa-check"></i><b>7</b> Text Processing</a>
<ul>
<li class="chapter" data-level="7.1" data-path="text-processing.html"><a href="text-processing.html#tweets-分析"><i class="fa fa-check"></i><b>7.1</b> Tweets 分析</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="text-processing.html"><a href="text-processing.html#載入並清理資料"><i class="fa fa-check"></i><b>7.1.1</b> 載入並清理資料</a></li>
<li class="chapter" data-level="7.1.2" data-path="text-processing.html"><a href="text-processing.html#萃取資料"><i class="fa fa-check"></i><b>7.1.2</b> 萃取資料</a></li>
<li class="chapter" data-level="7.1.3" data-path="text-processing.html"><a href="text-processing.html#視覺化探索"><i class="fa fa-check"></i><b>7.1.3</b> 視覺化探索</a></li>
<li class="chapter" data-level="7.1.4" data-path="text-processing.html"><a href="text-processing.html#keyness"><i class="fa fa-check"></i><b>7.1.4</b> Keyness</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="crawler.html"><a href="crawler.html"><i class="fa fa-check"></i><b>8</b> Crawler</a>
<ul>
<li class="chapter" data-level="8.1" data-path="crawler.html"><a href="crawler.html#scraping-104.com"><i class="fa fa-check"></i><b>8.1</b> Scraping 104.com</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="crawler.html"><a href="crawler.html#complete-code"><i class="fa fa-check"></i><b>8.1.1</b> Complete Code</a></li>
<li class="chapter" data-level="8.1.2" data-path="crawler.html"><a href="crawler.html#step-by-step"><i class="fa fa-check"></i><b>8.1.2</b> Step-by-Step</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III VISUALIZATION</b></span></li>
<li class="chapter" data-level="9" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>9</b> Visualization</a>
<ul>
<li class="chapter" data-level="9.1" data-path="visualization.html"><a href="visualization.html#ggplot"><i class="fa fa-check"></i><b>9.1</b> ggplot簡介</a></li>
<li class="chapter" data-level="9.2" data-path="visualization.html"><a href="visualization.html#繪圖基礎折線圖"><i class="fa fa-check"></i><b>9.2</b> 繪圖基礎：折線圖</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="visualization.html"><a href="visualization.html#繪圖三要素"><i class="fa fa-check"></i><b>9.2.1</b> 繪圖三要素</a></li>
<li class="chapter" data-level="9.2.2" data-path="visualization.html"><a href="visualization.html#範例-紐時世代貧富不均"><i class="fa fa-check"></i><b>9.2.2</b> 範例-紐時世代貧富不均</a></li>
<li class="chapter" data-level="9.2.3" data-path="visualization.html"><a href="visualization.html#加入自變項群組"><i class="fa fa-check"></i><b>9.2.3</b> 加入自變項群組</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="visualization.html"><a href="visualization.html#圖表調整"><i class="fa fa-check"></i><b>9.3</b> 圖表調整</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="visualization.html"><a href="visualization.html#點線型態"><i class="fa fa-check"></i><b>9.3.1</b> 點線型態</a></li>
<li class="chapter" data-level="9.3.2" data-path="visualization.html"><a href="visualization.html#標題標籤與圖說"><i class="fa fa-check"></i><b>9.3.2</b> 標題、標籤與圖說</a></li>
<li class="chapter" data-level="9.3.3" data-path="visualization.html"><a href="visualization.html#字體樣式"><i class="fa fa-check"></i><b>9.3.3</b> 字體樣式</a></li>
<li class="chapter" data-level="9.3.4" data-path="visualization.html"><a href="visualization.html#圖表主題色調"><i class="fa fa-check"></i><b>9.3.4</b> 圖表主題色調</a></li>
<li class="chapter" data-level="9.3.5" data-path="visualization.html"><a href="visualization.html#預設主題"><i class="fa fa-check"></i><b>9.3.5</b> 預設主題</a></li>
<li class="chapter" data-level="9.3.6" data-path="visualization.html"><a href="visualization.html#顯示中文字體"><i class="fa fa-check"></i><b>9.3.6</b> 顯示中文字體</a></li>
<li class="chapter" data-level="9.3.7" data-path="visualization.html"><a href="visualization.html#xy軸方向"><i class="fa fa-check"></i><b>9.3.7</b> X/Y軸方向</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="visualization.html"><a href="visualization.html#視覺化說故事的技巧"><i class="fa fa-check"></i><b>9.4</b> 視覺化說故事的技巧</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="visualization.html"><a href="visualization.html#依群組指定顏色"><i class="fa fa-check"></i><b>9.4.1</b> 依群組指定顏色</a></li>
<li class="chapter" data-level="9.4.2" data-path="visualization.html"><a href="visualization.html#使用gghighlight套件"><i class="fa fa-check"></i><b>9.4.2</b> 使用gghighlight套件</a></li>
<li class="chapter" data-level="9.4.3" data-path="visualization.html"><a href="visualization.html#為視覺化建立群組"><i class="fa fa-check"></i><b>9.4.3</b> 為視覺化建立群組</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="visualization.html"><a href="visualization.html#colors"><i class="fa fa-check"></i><b>9.5</b> COLORS</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chart-types.html"><a href="chart-types.html"><i class="fa fa-check"></i><b>10</b> CHART TYPES</a></li>
<li class="chapter" data-level="11" data-path="COORDINATE.html"><a href="COORDINATE.html"><i class="fa fa-check"></i><b>11</b> COORDINATE</a>
<ul>
<li class="chapter" data-level="11.1" data-path="COORDINATE.html"><a href="COORDINATE.html#排序以展示分佈"><i class="fa fa-check"></i><b>11.1</b> 排序以展示分佈</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="COORDINATE.html"><a href="COORDINATE.html#section"><i class="fa fa-check"></i><b>11.1.1</b> </a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="COORDINATE.html"><a href="COORDINATE.html#用log-scale放大長尾頭部"><i class="fa fa-check"></i><b>11.2</b> 用Log-scale放大長尾頭部</a></li>
<li class="chapter" data-level="11.3" data-path="COORDINATE.html"><a href="COORDINATE.html#square-root-scale"><i class="fa fa-check"></i><b>11.3</b> Square-root scale</a></li>
<li class="chapter" data-level="11.4" data-path="COORDINATE.html"><a href="COORDINATE.html#座標軸從數值到增加值"><i class="fa fa-check"></i><b>11.4</b> 座標軸從數值到增加值</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="COORDINATE.html"><a href="COORDINATE.html#net-worth-by-age-group-wgoitg-of-nytimes"><i class="fa fa-check"></i><b>11.4.1</b> Net Worth by Age Group (WGOITG of NYTIMES)</a></li>
<li class="chapter" data-level="11.4.2" data-path="COORDINATE.html"><a href="COORDINATE.html#read-and-sort-data"><i class="fa fa-check"></i><b>11.4.2</b> Read and sort data</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="COORDINATE.html"><a href="COORDINATE.html#等比例座標軸"><i class="fa fa-check"></i><b>11.5</b> 等比例座標軸</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="COORDINATE.html"><a href="COORDINATE.html#unicef-optimistic-wgoith"><i class="fa fa-check"></i><b>11.5.1</b> UNICEF-Optimistic (WGOITH)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="amount.html"><a href="amount.html"><i class="fa fa-check"></i><b>12</b> AMOUNT</a>
<ul>
<li class="chapter" data-level="12.1" data-path="amount.html"><a href="amount.html#bar-chart"><i class="fa fa-check"></i><b>12.1</b> Bar chart</a></li>
<li class="chapter" data-level="12.2" data-path="amount.html"><a href="amount.html#heatmap-vaccination"><i class="fa fa-check"></i><b>12.2</b> Heatmap: Vaccination</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="distribution-histogram-density.html"><a href="distribution-histogram-density.html"><i class="fa fa-check"></i><b>13</b> DISTRIBUTION: Histogram &amp; Density</a>
<ul>
<li class="chapter" data-level="13.1" data-path="distribution-histogram-density.html"><a href="distribution-histogram-density.html#density-plot"><i class="fa fa-check"></i><b>13.1</b> Density plot</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="distribution-histogram-density.html"><a href="distribution-histogram-density.html#density-with-different-bandwidth"><i class="fa fa-check"></i><b>13.1.1</b> Density with different bandwidth</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="distribution-histogram-density.html"><a href="distribution-histogram-density.html#histogram"><i class="fa fa-check"></i><b>13.2</b> Histogram</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="distribution-histogram-density.html"><a href="distribution-histogram-density.html#histogram-with-different-number-of-bins"><i class="fa fa-check"></i><b>13.2.1</b> Histogram with different number of bins</a></li>
<li class="chapter" data-level="13.2.2" data-path="distribution-histogram-density.html"><a href="distribution-histogram-density.html#density-vs-histogram"><i class="fa fa-check"></i><b>13.2.2</b> Density vs histogram</a></li>
<li class="chapter" data-level="13.2.3" data-path="distribution-histogram-density.html"><a href="distribution-histogram-density.html#positions-of-bar-chart"><i class="fa fa-check"></i><b>13.2.3</b> Positions of bar chart</a></li>
<li class="chapter" data-level="13.2.4" data-path="distribution-histogram-density.html"><a href="distribution-histogram-density.html#display-two-groups-histogram-by-facet_wrap"><i class="fa fa-check"></i><b>13.2.4</b> Display two groups histogram by facet_wrap()</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="distribution-histogram-density.html"><a href="distribution-histogram-density.html#pyramid-plot"><i class="fa fa-check"></i><b>13.3</b> Pyramid Plot</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="distribution-histogram-density.html"><a href="distribution-histogram-density.html#modify-geom_col-to-pyramid-plot"><i class="fa fa-check"></i><b>13.3.1</b> Modify geom_col() to pyramid plot</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="distribution-histogram-density.html"><a href="distribution-histogram-density.html#box-plot-muitiple-distrubution"><i class="fa fa-check"></i><b>13.4</b> Box plot: Muitiple Distrubution</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="distribution-histogram-density.html"><a href="distribution-histogram-density.html#tw-salary-boxplot"><i class="fa fa-check"></i><b>13.4.1</b> TW-Salary (boxplot)</a></li>
<li class="chapter" data-level="13.4.2" data-path="distribution-histogram-density.html"><a href="distribution-histogram-density.html#tw-income-boxplot"><i class="fa fa-check"></i><b>13.4.2</b> TW-Income (boxplot)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="proportion.html"><a href="proportion.html"><i class="fa fa-check"></i><b>14</b> PROPORTION</a>
<ul>
<li class="chapter" data-level="14.1" data-path="proportion.html"><a href="proportion.html#pie-chart"><i class="fa fa-check"></i><b>14.1</b> Pie Chart</a></li>
<li class="chapter" data-level="14.2" data-path="proportion.html"><a href="proportion.html#dodged-bar-chart"><i class="fa fa-check"></i><b>14.2</b> Dodged Bar Chart</a></li>
<li class="chapter" data-level="14.3" data-path="proportion.html"><a href="proportion.html#treemap-nested-proportion"><i class="fa fa-check"></i><b>14.3</b> Treemap: Nested Proportion</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="proportion.html"><a href="proportion.html#global-carbon-projects-wgoith-nytimes"><i class="fa fa-check"></i><b>14.3.1</b> Global Carbon Projects (WGOITH-NYTIMES)</a></li>
<li class="chapter" data-level="14.3.2" data-path="proportion.html"><a href="proportion.html#tw-budget"><i class="fa fa-check"></i><b>14.3.2</b> TW Budget</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="association.html"><a href="association.html"><i class="fa fa-check"></i><b>15</b> ASSOCIATION</a>
<ul>
<li class="chapter" data-level="15.1" data-path="association.html"><a href="association.html#等比例座標軸-1"><i class="fa fa-check"></i><b>15.1</b> 等比例座標軸</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="association.html"><a href="association.html#unicef-optimistic-wgoith-1"><i class="fa fa-check"></i><b>15.1.1</b> UNICEF-Optimistic (WGOITH)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="time-trends.html"><a href="time-trends.html"><i class="fa fa-check"></i><b>16</b> TIME &amp; TRENDS</a></li>
<li class="chapter" data-level="17" data-path="network-vis.html"><a href="network-vis.html"><i class="fa fa-check"></i><b>17</b> NETWORK VIS</a>
<ul>
<li class="chapter" data-level="17.1" data-path="network-vis.html"><a href="network-vis.html#generating-networks"><i class="fa fa-check"></i><b>17.1</b> Generating networks</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="network-vis.html"><a href="network-vis.html#random-network"><i class="fa fa-check"></i><b>17.1.1</b> Random network</a></li>
<li class="chapter" data-level="17.1.2" data-path="network-vis.html"><a href="network-vis.html#random-network-1"><i class="fa fa-check"></i><b>17.1.2</b> Random network</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="network-vis.html"><a href="network-vis.html#retrieve-top3-components"><i class="fa fa-check"></i><b>17.2</b> Retrieve Top3 Components</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="network-vis.html"><a href="network-vis.html#visualize-again"><i class="fa fa-check"></i><b>17.2.1</b> Visualize again</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="network-vis.html"><a href="network-vis.html#motif-visualization-and-analysis"><i class="fa fa-check"></i><b>17.3</b> Motif visualization and analysis</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="network-vis.html"><a href="network-vis.html#motif-type"><i class="fa fa-check"></i><b>17.3.1</b> Motif type</a></li>
<li class="chapter" data-level="17.3.2" data-path="network-vis.html"><a href="network-vis.html#motif-analysis"><i class="fa fa-check"></i><b>17.3.2</b> Motif analysis</a></li>
<li class="chapter" data-level="17.3.3" data-path="network-vis.html"><a href="network-vis.html#generate-motives"><i class="fa fa-check"></i><b>17.3.3</b> Generate motives</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="geospatial.html"><a href="geospatial.html"><i class="fa fa-check"></i><b>18</b> GEOSPATIAL</a></li>
<li class="chapter" data-level="19" data-path="interactivity.html"><a href="interactivity.html"><i class="fa fa-check"></i><b>19</b> Interactivity</a>
<ul>
<li class="chapter" data-level="19.1" data-path="interactivity.html"><a href="interactivity.html#ggplotly"><i class="fa fa-check"></i><b>19.1</b> ggplotly</a>
<ul>
<li class="chapter" data-level="19.1.1" data-path="interactivity.html"><a href="interactivity.html#line-chart"><i class="fa fa-check"></i><b>19.1.1</b> LINE CHART</a></li>
<li class="chapter" data-level="19.1.2" data-path="interactivity.html"><a href="interactivity.html#scatter"><i class="fa fa-check"></i><b>19.1.2</b> SCATTER</a></li>
<li class="chapter" data-level="19.1.3" data-path="interactivity.html"><a href="interactivity.html#barplot"><i class="fa fa-check"></i><b>19.1.3</b> Barplot</a></li>
<li class="chapter" data-level="19.1.4" data-path="interactivity.html"><a href="interactivity.html#boxplot"><i class="fa fa-check"></i><b>19.1.4</b> Boxplot</a></li>
<li class="chapter" data-level="19.1.5" data-path="interactivity.html"><a href="interactivity.html#treemap-global-carbon"><i class="fa fa-check"></i><b>19.1.5</b> Treemap (Global Carbon)</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="interactivity.html"><a href="interactivity.html#產製圖表動畫"><i class="fa fa-check"></i><b>19.2</b> 產製圖表動畫</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="interactivity.html"><a href="interactivity.html#地圖下載與轉換投影方法"><i class="fa fa-check"></i><b>19.2.1</b> 地圖下載與轉換投影方法</a></li>
<li class="chapter" data-level="19.2.2" data-path="interactivity.html"><a href="interactivity.html#靜態繪圖測試"><i class="fa fa-check"></i><b>19.2.2</b> 靜態繪圖測試</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>20</b> Appendix</a>
<ul>
<li class="chapter" data-level="20.1" data-path="appendix.html"><a href="appendix.html#dataset"><i class="fa fa-check"></i><b>20.1</b> Dataset</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="wgoitg.html"><a href="wgoitg.html"><i class="fa fa-check"></i><b>21</b> WGOITG of NyTimes</a>
<ul>
<li class="chapter" data-level="21.1" data-path="wgoitg.html"><a href="wgoitg.html#inequality-net-worth-by-age-group"><i class="fa fa-check"></i><b>21.1</b> Inequality: Net Worth by Age Group</a></li>
<li class="chapter" data-level="21.2" data-path="wgoitg.html"><a href="wgoitg.html#unicef-global-survey-optimism"><i class="fa fa-check"></i><b>21.2</b> UNICEF-Global Survey Optimism</a></li>
<li class="chapter" data-level="21.3" data-path="wgoitg.html"><a href="wgoitg.html#global-carbon-projects"><i class="fa fa-check"></i><b>21.3</b> Global Carbon Projects</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="taiwan.html"><a href="taiwan.html"><i class="fa fa-check"></i><b>22</b> Case Studies (Taiwan)</a>
<ul>
<li class="chapter" data-level="22.1" data-path="taiwan.html"><a href="taiwan.html#tw-aqi-visual-studies"><i class="fa fa-check"></i><b>22.1</b> TW AQI Visual Studies</a>
<ul>
<li class="chapter" data-level="22.1.1" data-path="taiwan.html"><a href="taiwan.html#trending-central-tendency"><i class="fa fa-check"></i><b>22.1.1</b> Trending: Central tendency</a></li>
<li class="chapter" data-level="22.1.2" data-path="taiwan.html"><a href="taiwan.html#trending-extreme-value"><i class="fa fa-check"></i><b>22.1.2</b> Trending: Extreme value</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Data Journalism</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-manipulation-wity-tidyverse" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Data Manipulation wity tidyverse<a href="data-manipulation-wity-tidyverse.html#data-manipulation-wity-tidyverse" class="anchor-section" aria-label="Anchor link to header"></a></h1>

<div id="base-to-dplyr-tp-theft" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> base to dplyr: TP Theft<a href="data-manipulation-wity-tidyverse.html#base-to-dplyr-tp-theft" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="data-manipulation-wity-tidyverse.html#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb337-2"><a href="data-manipulation-wity-tidyverse.html#cb337-2" aria-hidden="true" tabindex="-1"></a><span class="co"># options(stringsAsFactors = F) # default options in R ver.&gt; 4.0</span></span></code></pre></div>
<div id="reading-data" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Reading data<a href="data-manipulation-wity-tidyverse.html#reading-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="data-manipulation-wity-tidyverse.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read by read_csv()</span></span>
<span id="cb338-2"><a href="data-manipulation-wity-tidyverse.html#cb338-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Will raise error</span></span>
<span id="cb338-3"><a href="data-manipulation-wity-tidyverse.html#cb338-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Error in make.names(x) : invalid multibyte string at &#39;&lt;bd&gt;s&lt;b8&gt;&lt;b9&gt;&#39;</span></span>
<span id="cb338-4"><a href="data-manipulation-wity-tidyverse.html#cb338-4" aria-hidden="true" tabindex="-1"></a><span class="co"># df &lt;- read_csv(&quot;data/tp_theft.csv&quot;)</span></span>
<span id="cb338-5"><a href="data-manipulation-wity-tidyverse.html#cb338-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-6"><a href="data-manipulation-wity-tidyverse.html#cb338-6" aria-hidden="true" tabindex="-1"></a><span class="co"># read_csv() with locale = locale(encoding = &quot;Big5&quot;)</span></span>
<span id="cb338-7"><a href="data-manipulation-wity-tidyverse.html#cb338-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb338-8"><a href="data-manipulation-wity-tidyverse.html#cb338-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/臺北市住宅竊盜點位資訊-UTF8-BOM-1.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="cleaning-data-i" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Cleaning data I<a href="data-manipulation-wity-tidyverse.html#cleaning-data-i" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Renaming variables by <code>select()</code></li>
<li>Generating variable year</li>
<li>Generating variable month</li>
<li>Retrieving area</li>
</ul>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="data-manipulation-wity-tidyverse.html#cb339-1" aria-hidden="true" tabindex="-1"></a>selected_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb339-2"><a href="data-manipulation-wity-tidyverse.html#cb339-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">id =</span> 編號, </span>
<span id="cb339-3"><a href="data-manipulation-wity-tidyverse.html#cb339-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">cat =</span> 案類, </span>
<span id="cb339-4"><a href="data-manipulation-wity-tidyverse.html#cb339-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">date =</span> <span class="st">`</span><span class="at">發生日期</span><span class="st">`</span>, </span>
<span id="cb339-5"><a href="data-manipulation-wity-tidyverse.html#cb339-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">time =</span> <span class="st">`</span><span class="at">發生時段</span><span class="st">`</span>, </span>
<span id="cb339-6"><a href="data-manipulation-wity-tidyverse.html#cb339-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">location =</span> <span class="st">`</span><span class="at">發生地點</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb339-7"><a href="data-manipulation-wity-tidyverse.html#cb339-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> date <span class="sc">%/%</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb339-8"><a href="data-manipulation-wity-tidyverse.html#cb339-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">month =</span> date <span class="sc">%/%</span> <span class="dv">100</span> <span class="sc">%%</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb339-9"><a href="data-manipulation-wity-tidyverse.html#cb339-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">area =</span> stringr<span class="sc">::</span><span class="fu">str_sub</span>(location, <span class="dv">4</span>, <span class="dv">6</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb339-10"><a href="data-manipulation-wity-tidyverse.html#cb339-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">county =</span> stringr<span class="sc">::</span><span class="fu">str_sub</span>(location, <span class="dv">1</span>, <span class="dv">3</span>))</span></code></pre></div>
</div>
<div id="cleaning-data-ii" class="section level3 hasAnchor" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Cleaning data II<a href="data-manipulation-wity-tidyverse.html#cleaning-data-ii" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Filtering out irrelevant data records</li>
</ul>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="data-manipulation-wity-tidyverse.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co"># readr::guess_encoding(&quot;data/tp_theft.csv&quot;)</span></span>
<span id="cb340-2"><a href="data-manipulation-wity-tidyverse.html#cb340-2" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="ot">&lt;-</span> selected_df <span class="sc">%&gt;%</span></span>
<span id="cb340-3"><a href="data-manipulation-wity-tidyverse.html#cb340-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># count(year) %&gt;% View</span></span>
<span id="cb340-4"><a href="data-manipulation-wity-tidyverse.html#cb340-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(county <span class="sc">==</span> <span class="st">&quot;臺北市&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb340-5"><a href="data-manipulation-wity-tidyverse.html#cb340-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">104</span>) <span class="sc">%&gt;%</span></span>
<span id="cb340-6"><a href="data-manipulation-wity-tidyverse.html#cb340-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># count(time) %&gt;% View</span></span>
<span id="cb340-7"><a href="data-manipulation-wity-tidyverse.html#cb340-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># count(location) %&gt;%</span></span>
<span id="cb340-8"><a href="data-manipulation-wity-tidyverse.html#cb340-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>area <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;中和市&quot;</span>, <span class="st">&quot;板橋市&quot;</span>))</span></code></pre></div>
</div>
<div id="long-to-wide-form" class="section level3 hasAnchor" number="6.1.4">
<h3><span class="header-section-number">6.1.4</span> Long to wide form<a href="data-manipulation-wity-tidyverse.html#long-to-wide-form" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><code>count()</code> two variables</li>
<li><code>spread()</code> spread one variable as columns to wide form</li>
</ul>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="data-manipulation-wity-tidyverse.html#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="co"># count() then spread()</span></span>
<span id="cb341-2"><a href="data-manipulation-wity-tidyverse.html#cb341-2" aria-hidden="true" tabindex="-1"></a>df.wide <span class="ot">&lt;-</span> filtered_df <span class="sc">%&gt;%</span> </span>
<span id="cb341-3"><a href="data-manipulation-wity-tidyverse.html#cb341-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(time, area) <span class="sc">%&gt;%</span></span>
<span id="cb341-4"><a href="data-manipulation-wity-tidyverse.html#cb341-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">spread</span>(area, n, <span class="at">fill=</span><span class="dv">0</span>) </span></code></pre></div>
</div>
<div id="setting-time-as-row.name-for-mosaicplot" class="section level3 hasAnchor" number="6.1.5">
<h3><span class="header-section-number">6.1.5</span> Setting time as row.name for mosaicplot<a href="data-manipulation-wity-tidyverse.html#setting-time-as-row.name-for-mosaicplot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="data-manipulation-wity-tidyverse.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df.wide) <span class="ot">&lt;-</span> df.wide<span class="sc">$</span>time</span>
<span id="cb342-2"><a href="data-manipulation-wity-tidyverse.html#cb342-2" aria-hidden="true" tabindex="-1"></a>df.wide<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="data-manipulation-wity-tidyverse.html#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify fonts for Chinese</span></span>
<span id="cb343-2"><a href="data-manipulation-wity-tidyverse.html#cb343-2" aria-hidden="true" tabindex="-1"></a><span class="co"># par(family=(&#39;STKaiti&#39;)) </span></span>
<span id="cb343-3"><a href="data-manipulation-wity-tidyverse.html#cb343-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">family=</span>(<span class="st">&#39;Heiti TC Light&#39;</span>)) <span class="co"># for mac</span></span>
<span id="cb343-4"><a href="data-manipulation-wity-tidyverse.html#cb343-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-5"><a href="data-manipulation-wity-tidyverse.html#cb343-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify colors</span></span>
<span id="cb343-6"><a href="data-manipulation-wity-tidyverse.html#cb343-6" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;#D0104C&#39;</span>, <span class="st">&#39;#DB4D6D&#39;</span>, <span class="st">&#39;#E83015&#39;</span>,  <span class="st">&#39;#F75C2F&#39;</span>,</span>
<span id="cb343-7"><a href="data-manipulation-wity-tidyverse.html#cb343-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;#E79460&#39;</span>, <span class="st">&#39;#E98B2A&#39;</span>, <span class="st">&#39;#9B6E23&#39;</span>, <span class="st">&#39;#F7C242&#39;</span>,</span>
<span id="cb343-8"><a href="data-manipulation-wity-tidyverse.html#cb343-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;#BEC23F&#39;</span>, <span class="st">&#39;#90B44B&#39;</span>, <span class="st">&#39;#66BAB7&#39;</span>, <span class="st">&#39;#1E88A8&#39;</span>)</span>
<span id="cb343-9"><a href="data-manipulation-wity-tidyverse.html#cb343-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-10"><a href="data-manipulation-wity-tidyverse.html#cb343-10" aria-hidden="true" tabindex="-1"></a><span class="co"># mosaicplot()</span></span>
<span id="cb343-11"><a href="data-manipulation-wity-tidyverse.html#cb343-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(df.wide, <span class="at">color=</span>colors, <span class="at">border=</span><span class="dv">0</span>, <span class="at">off =</span> <span class="dv">3</span>,</span>
<span id="cb343-12"><a href="data-manipulation-wity-tidyverse.html#cb343-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span><span class="st">&quot;Theft rate of Taipei city (region by hour)&quot;</span>)</span></code></pre></div>
<p><img src="R-for-Data-Journalism_files/figure-html/unnamed-chunk-95-1.png" width="672" /></p>
</div>
<div id="clean-version" class="section level3 hasAnchor" number="6.1.6">
<h3><span class="header-section-number">6.1.6</span> Clean version<a href="data-manipulation-wity-tidyverse.html#clean-version" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="data-manipulation-wity-tidyverse.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb344-2"><a href="data-manipulation-wity-tidyverse.html#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="co"># options(stringsAsFactors = F)</span></span>
<span id="cb344-3"><a href="data-manipulation-wity-tidyverse.html#cb344-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/臺北市住宅竊盜點位資訊-UTF8-BOM-1.csv&quot;</span>)</span>
<span id="cb344-4"><a href="data-manipulation-wity-tidyverse.html#cb344-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-5"><a href="data-manipulation-wity-tidyverse.html#cb344-5" aria-hidden="true" tabindex="-1"></a>selected_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb344-6"><a href="data-manipulation-wity-tidyverse.html#cb344-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">id =</span> 編號, </span>
<span id="cb344-7"><a href="data-manipulation-wity-tidyverse.html#cb344-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">cat =</span> 案類,</span>
<span id="cb344-8"><a href="data-manipulation-wity-tidyverse.html#cb344-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">date =</span> <span class="st">`</span><span class="at">發生日期</span><span class="st">`</span>, </span>
<span id="cb344-9"><a href="data-manipulation-wity-tidyverse.html#cb344-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">time =</span> <span class="st">`</span><span class="at">發生時段</span><span class="st">`</span>, </span>
<span id="cb344-10"><a href="data-manipulation-wity-tidyverse.html#cb344-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">location =</span> <span class="st">`</span><span class="at">發生地點</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb344-11"><a href="data-manipulation-wity-tidyverse.html#cb344-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> date <span class="sc">%/%</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb344-12"><a href="data-manipulation-wity-tidyverse.html#cb344-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">month =</span> date <span class="sc">%/%</span> <span class="dv">100</span> <span class="sc">%%</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb344-13"><a href="data-manipulation-wity-tidyverse.html#cb344-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">area =</span> stringr<span class="sc">::</span><span class="fu">str_sub</span>(location, <span class="dv">4</span>, <span class="dv">6</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb344-14"><a href="data-manipulation-wity-tidyverse.html#cb344-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">county =</span> stringr<span class="sc">::</span><span class="fu">str_sub</span>(location, <span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb344-15"><a href="data-manipulation-wity-tidyverse.html#cb344-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-16"><a href="data-manipulation-wity-tidyverse.html#cb344-16" aria-hidden="true" tabindex="-1"></a>selected_df <span class="sc">%&gt;%</span> <span class="fu">count</span>(year)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
103
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
104
</td>
<td style="text-align:right;">
687
</td>
</tr>
<tr>
<td style="text-align:right;">
105
</td>
<td style="text-align:right;">
663
</td>
</tr>
<tr>
<td style="text-align:right;">
106
</td>
<td style="text-align:right;">
560
</td>
</tr>
<tr>
<td style="text-align:right;">
107
</td>
<td style="text-align:right;">
501
</td>
</tr>
<tr>
<td style="text-align:right;">
108
</td>
<td style="text-align:right;">
411
</td>
</tr>
<tr>
<td style="text-align:right;">
109
</td>
<td style="text-align:right;">
304
</td>
</tr>
<tr>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;">
189
</td>
</tr>
<tr>
<td style="text-align:right;">
111
</td>
<td style="text-align:right;">
31
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="data-manipulation-wity-tidyverse.html#cb345-1" aria-hidden="true" tabindex="-1"></a>selected_df <span class="sc">%&gt;%</span> <span class="fu">count</span>(time) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
time
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
00~02
</td>
<td style="text-align:right;">
272
</td>
</tr>
<tr>
<td style="text-align:left;">
02~04
</td>
<td style="text-align:right;">
214
</td>
</tr>
<tr>
<td style="text-align:left;">
03~05
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
04~06
</td>
<td style="text-align:right;">
156
</td>
</tr>
<tr>
<td style="text-align:left;">
05~07
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:left;">
06~08
</td>
<td style="text-align:right;">
191
</td>
</tr>
<tr>
<td style="text-align:left;">
08~10
</td>
<td style="text-align:right;">
305
</td>
</tr>
<tr>
<td style="text-align:left;">
09~11
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
10~12
</td>
<td style="text-align:right;">
338
</td>
</tr>
<tr>
<td style="text-align:left;">
11~03
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="data-manipulation-wity-tidyverse.html#cb346-1" aria-hidden="true" tabindex="-1"></a>selected_df <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(time) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
cat
</th>
<th style="text-align:right;">
date
</th>
<th style="text-align:left;">
time
</th>
<th style="text-align:left;">
location
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
month
</th>
<th style="text-align:left;">
area
</th>
<th style="text-align:left;">
county
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
住宅竊盜
</td>
<td style="text-align:right;">
1040101
</td>
<td style="text-align:left;">
00~02
</td>
<td style="text-align:left;">
臺北市文山區萬美里萬寧街1~30號
</td>
<td style="text-align:right;">
104
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
文山區
</td>
<td style="text-align:left;">
臺北市
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
住宅竊盜
</td>
<td style="text-align:right;">
1040101
</td>
<td style="text-align:left;">
00~02
</td>
<td style="text-align:left;">
臺北市信義區富台里忠孝東路5段295巷6弄1~30號
</td>
<td style="text-align:right;">
104
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
信義區
</td>
<td style="text-align:left;">
臺北市
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
住宅竊盜
</td>
<td style="text-align:right;">
1040102
</td>
<td style="text-align:left;">
00~02
</td>
<td style="text-align:left;">
臺北市士林區天福里1鄰忠誠路2段130巷1~30號
</td>
<td style="text-align:right;">
104
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
士林區
</td>
<td style="text-align:left;">
臺北市
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
住宅竊盜
</td>
<td style="text-align:right;">
1040105
</td>
<td style="text-align:left;">
00~02
</td>
<td style="text-align:left;">
臺北市中山區南京東路3段181~210號
</td>
<td style="text-align:right;">
104
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
中山區
</td>
<td style="text-align:left;">
臺北市
</td>
</tr>
<tr>
<td style="text-align:right;">
33
</td>
<td style="text-align:left;">
住宅竊盜
</td>
<td style="text-align:right;">
1040115
</td>
<td style="text-align:left;">
00~02
</td>
<td style="text-align:left;">
臺北市松山區饒河街181~210號
</td>
<td style="text-align:right;">
104
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
松山區
</td>
<td style="text-align:left;">
臺北市
</td>
</tr>
<tr>
<td style="text-align:right;">
74
</td>
<td style="text-align:left;">
住宅竊盜
</td>
<td style="text-align:right;">
1040131
</td>
<td style="text-align:left;">
00~02
</td>
<td style="text-align:left;">
臺北市南港區重陽路57巷1~30號
</td>
<td style="text-align:right;">
104
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
南港區
</td>
<td style="text-align:left;">
臺北市
</td>
</tr>
<tr>
<td style="text-align:right;">
75
</td>
<td style="text-align:left;">
住宅竊盜
</td>
<td style="text-align:right;">
1040201
</td>
<td style="text-align:left;">
00~02
</td>
<td style="text-align:left;">
臺北市北投區中心里中和街31~60號
</td>
<td style="text-align:right;">
104
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
北投區
</td>
<td style="text-align:left;">
臺北市
</td>
</tr>
<tr>
<td style="text-align:right;">
92
</td>
<td style="text-align:left;">
住宅竊盜
</td>
<td style="text-align:right;">
1040210
</td>
<td style="text-align:left;">
00~02
</td>
<td style="text-align:left;">
臺北市北投區大同路200巷1~30號
</td>
<td style="text-align:right;">
104
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
北投區
</td>
<td style="text-align:left;">
臺北市
</td>
</tr>
<tr>
<td style="text-align:right;">
95
</td>
<td style="text-align:left;">
住宅竊盜
</td>
<td style="text-align:right;">
1040212
</td>
<td style="text-align:left;">
00~02
</td>
<td style="text-align:left;">
臺北市萬華區萬大路493巷48弄1~30號
</td>
<td style="text-align:right;">
104
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
萬華區
</td>
<td style="text-align:left;">
臺北市
</td>
</tr>
<tr>
<td style="text-align:right;">
106
</td>
<td style="text-align:left;">
住宅竊盜
</td>
<td style="text-align:right;">
1040216
</td>
<td style="text-align:left;">
00~02
</td>
<td style="text-align:left;">
臺北市信義區吳興街269巷1~30號
</td>
<td style="text-align:right;">
104
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
信義區
</td>
<td style="text-align:left;">
臺北市
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="data-manipulation-wity-tidyverse.html#cb347-1" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="ot">&lt;-</span> selected_df <span class="sc">%&gt;%</span></span>
<span id="cb347-2"><a href="data-manipulation-wity-tidyverse.html#cb347-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># count(year) %&gt;% View</span></span>
<span id="cb347-3"><a href="data-manipulation-wity-tidyverse.html#cb347-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">104</span>) <span class="sc">%&gt;%</span></span>
<span id="cb347-4"><a href="data-manipulation-wity-tidyverse.html#cb347-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;03~05&quot;</span>, <span class="st">&quot;05~07&quot;</span>, <span class="st">&quot;09~11&quot;</span>, <span class="st">&quot;11~13&quot;</span>, <span class="st">&quot;15~17&quot;</span>, <span class="st">&quot;17~19&quot;</span>, <span class="st">&quot;18~21&quot;</span>, <span class="st">&quot;21~23&quot;</span>, <span class="st">&quot;23~01&quot;</span>))</span>
<span id="cb347-5"><a href="data-manipulation-wity-tidyverse.html#cb347-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># count(time) %&gt;% View</span></span>
<span id="cb347-6"><a href="data-manipulation-wity-tidyverse.html#cb347-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># count(location) %&gt;%</span></span>
<span id="cb347-7"><a href="data-manipulation-wity-tidyverse.html#cb347-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># filter(!area %in% c(&quot;中和市&quot;, &quot;板橋市&quot;))</span></span>
<span id="cb347-8"><a href="data-manipulation-wity-tidyverse.html#cb347-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-9"><a href="data-manipulation-wity-tidyverse.html#cb347-9" aria-hidden="true" tabindex="-1"></a>df.wide <span class="ot">&lt;-</span> filtered_df <span class="sc">%&gt;%</span> </span>
<span id="cb347-10"><a href="data-manipulation-wity-tidyverse.html#cb347-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(time, area) <span class="sc">%&gt;%</span></span>
<span id="cb347-11"><a href="data-manipulation-wity-tidyverse.html#cb347-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">spread</span>(area, n, <span class="at">fill=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb347-12"><a href="data-manipulation-wity-tidyverse.html#cb347-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb347-13"><a href="data-manipulation-wity-tidyverse.html#cb347-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-14"><a href="data-manipulation-wity-tidyverse.html#cb347-14" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(df.wide) <span class="ot">&lt;-</span> df.wide<span class="sc">$</span>time</span>
<span id="cb347-15"><a href="data-manipulation-wity-tidyverse.html#cb347-15" aria-hidden="true" tabindex="-1"></a>df.wide<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb347-16"><a href="data-manipulation-wity-tidyverse.html#cb347-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-17"><a href="data-manipulation-wity-tidyverse.html#cb347-17" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">family=</span>(<span class="st">&#39;Heiti TC Light&#39;</span>)) <span class="co"># for mac</span></span>
<span id="cb347-18"><a href="data-manipulation-wity-tidyverse.html#cb347-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-19"><a href="data-manipulation-wity-tidyverse.html#cb347-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify colors</span></span>
<span id="cb347-20"><a href="data-manipulation-wity-tidyverse.html#cb347-20" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;#D0104C&#39;</span>, <span class="st">&#39;#DB4D6D&#39;</span>, <span class="st">&#39;#E83015&#39;</span>,  <span class="st">&#39;#F75C2F&#39;</span>,</span>
<span id="cb347-21"><a href="data-manipulation-wity-tidyverse.html#cb347-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;#E79460&#39;</span>, <span class="st">&#39;#E98B2A&#39;</span>, <span class="st">&#39;#9B6E23&#39;</span>, <span class="st">&#39;#F7C242&#39;</span>,</span>
<span id="cb347-22"><a href="data-manipulation-wity-tidyverse.html#cb347-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;#BEC23F&#39;</span>, <span class="st">&#39;#90B44B&#39;</span>, <span class="st">&#39;#66BAB7&#39;</span>, <span class="st">&#39;#1E88A8&#39;</span>)</span>
<span id="cb347-23"><a href="data-manipulation-wity-tidyverse.html#cb347-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-24"><a href="data-manipulation-wity-tidyverse.html#cb347-24" aria-hidden="true" tabindex="-1"></a><span class="co"># mosaicplot()</span></span>
<span id="cb347-25"><a href="data-manipulation-wity-tidyverse.html#cb347-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(df.wide, <span class="at">color=</span>colors, <span class="at">border=</span><span class="dv">0</span>, <span class="at">off =</span> <span class="dv">3</span>,</span>
<span id="cb347-26"><a href="data-manipulation-wity-tidyverse.html#cb347-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span><span class="st">&quot;Theft rate of Taipei city (region by hour)&quot;</span>)  </span></code></pre></div>
<p><img src="R-for-Data-Journalism_files/figure-html/unnamed-chunk-96-1.png" width="672" /></p>

</div>
</div>
<div id="空值na處理" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> 空值（NA）處理<a href="data-manipulation-wity-tidyverse.html#空值na處理" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>許多統計資料都會有不同程度的<code>NA</code>（缺失值、遺漏值）。缺失值產生的原因不一，可能有以下原因：</p>
<ol style="list-style-type: decimal">
<li>資料運算的時候產生的填空值。例如<code>spread()</code>和<code>pivot_wider()</code>經常會產生<code>NA</code>，也經常會指定值（例如0）來取代可能產生的<code>NA</code>。</li>
<li>資料紀錄的時候遺漏某些時間點的資料。</li>
<li>開放資料在開放時已經被整理成階層化、易於展示、一般人易懂的表格型態。此時，若將其讀入也會產生非常大量的<code>NA</code>。例如本章節所要提到的政府各部會預算比例。</li>
<li>紀錄資料筆數非常龐大、來源眾多、紀錄時間不一時，雖然有很多紀錄，但這些紀錄必須要被對齊、刪減，才能夠獲得有意義的可計算資料。例如本章節會提到的世界各國疫苗注射資料。</li>
</ol>
<div id="表格重整政府預算" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> 表格重整：政府預算<a href="data-manipulation-wity-tidyverse.html#表格重整政府預算" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="data-manipulation-wity-tidyverse.html#cb348-1" aria-hidden="true" tabindex="-1"></a>raw <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;data/111B歲出政事別預算表.xls&quot;</span>, <span class="at">skip=</span><span class="dv">3</span>, <span class="at">col_names =</span> F)</span>
<span id="cb348-2"><a href="data-manipulation-wity-tidyverse.html#cb348-2" aria-hidden="true" tabindex="-1"></a>raw <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
…1
</th>
<th style="text-align:left;">
…2
</th>
<th style="text-align:left;">
…3
</th>
<th style="text-align:left;">
…4
</th>
<th style="text-align:left;">
…5
</th>
<th style="text-align:left;">
…6
</th>
<th style="text-align:left;">
…7
</th>
<th style="text-align:left;">
…8
</th>
<th style="text-align:left;">
…9
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
科 目
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
本年度預算數
</td>
<td style="text-align:left;">
上年度預算數
</td>
<td style="text-align:left;">
前年度決算數
</td>
<td style="text-align:left;">
本年度與上年度
比 較
</td>
</tr>
<tr>
<td style="text-align:left;">
款
</td>
<td style="text-align:left;">
項
</td>
<td style="text-align:left;">
目
</td>
<td style="text-align:left;">
節
</td>
<td style="text-align:left;">
名 稱 及 編 號
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
合 計
</td>
<td style="text-align:left;">
2262064189
</td>
<td style="text-align:left;">
2135896877
</td>
<td style="text-align:left;">
2039353355.829
</td>
<td style="text-align:left;">
126167312
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
(1.一般政務支出)
</td>
<td style="text-align:left;">
210137299
</td>
<td style="text-align:left;">
202634617
</td>
<td style="text-align:left;">
190777048.02900001
</td>
<td style="text-align:left;">
7502682
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3100000000
國務支出
</td>
<td style="text-align:left;">
1210301
</td>
<td style="text-align:left;">
1186955
</td>
<td style="text-align:left;">
1176955.1259999999
</td>
<td style="text-align:left;">
23346
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3102010000
總統府
</td>
<td style="text-align:left;">
1004797
</td>
<td style="text-align:left;">
978916
</td>
<td style="text-align:left;">
997305.54599999997
</td>
<td style="text-align:left;">
25881
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3102010100
一般行政
</td>
<td style="text-align:left;">
920526
</td>
<td style="text-align:left;">
896334
</td>
<td style="text-align:left;">
882112.75600000005
</td>
<td style="text-align:left;">
24192
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3102010200
國務機要
</td>
<td style="text-align:left;">
30000
</td>
<td style="text-align:left;">
30000
</td>
<td style="text-align:left;">
29993.006000000001
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3102010300
國家慶典
</td>
<td style="text-align:left;">
15760
</td>
<td style="text-align:left;">
15760
</td>
<td style="text-align:left;">
45578.949000000001
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3102010400
研究發展
</td>
<td style="text-align:left;">
5332
</td>
<td style="text-align:left;">
5332
</td>
<td style="text-align:left;">
6720.1840000000002
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
</tbody>
</table>
<h4 id="基本清理" class="hasAnchor">基本清理<a href="data-manipulation-wity-tidyverse.html#基本清理" class="anchor-section" aria-label="Anchor link to header"></a></h4></li>
</ul></li>
</ul></li>
</ul>
<ol style="list-style-type: decimal">
<li>重新命名欄位名稱</li>
<li>刪去被當成表格標題的多於列（通常是前兩三列）<code>slice(-(1:2))</code>。</li>
<li>觀察資料，「款」可以說是支出大類的代號，例如總統府、行政支出、立法支出、軍事支出、教育支出等。「科」為該單位底下的部門或者項目，例如「行政支出」下有行政院、主計總處支出等。更底下的細類「目」並非本例的分析對象，所以可以刪除。所以，如果款、科均為空值的話，代表其為更細的「目」。因此篩去款科為空值的所有項目。<code>filter(!is.na(款) | !is.na(科))</code></li>
<li>將機構id和機構名稱切分開來，視覺化的時候只會用到機構名稱。<code>separate(機構, c("oid", "org"), sep="\n")</code></li>
</ol>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="data-manipulation-wity-tidyverse.html#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(raw) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;款&quot;</span>, <span class="st">&quot;科&quot;</span>, <span class="st">&quot;目&quot;</span>, <span class="st">&quot;節&quot;</span>, <span class="st">&quot;機構&quot;</span>, <span class="st">&quot;本年度預算&quot;</span>, <span class="st">&quot;上年度預算&quot;</span>, <span class="st">&quot;上年度決算&quot;</span>, <span class="st">&quot;預算差&quot;</span>)</span>
<span id="cb349-2"><a href="data-manipulation-wity-tidyverse.html#cb349-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-3"><a href="data-manipulation-wity-tidyverse.html#cb349-3" aria-hidden="true" tabindex="-1"></a>cleaned <span class="ot">&lt;-</span> raw <span class="sc">%&gt;%</span></span>
<span id="cb349-4"><a href="data-manipulation-wity-tidyverse.html#cb349-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb349-5"><a href="data-manipulation-wity-tidyverse.html#cb349-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(款) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(科)) <span class="sc">%&gt;%</span></span>
<span id="cb349-6"><a href="data-manipulation-wity-tidyverse.html#cb349-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>目, <span class="sc">-</span>節) <span class="sc">%&gt;%</span></span>
<span id="cb349-7"><a href="data-manipulation-wity-tidyverse.html#cb349-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(機構, <span class="fu">c</span>(<span class="st">&quot;oid&quot;</span>, <span class="st">&quot;org&quot;</span>), <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb349-8"><a href="data-manipulation-wity-tidyverse.html#cb349-8" aria-hidden="true" tabindex="-1"></a>cleaned <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
款
</th>
<th style="text-align:left;">
科
</th>
<th style="text-align:left;">
oid
</th>
<th style="text-align:left;">
org
</th>
<th style="text-align:left;">
本年度預算
</th>
<th style="text-align:left;">
上年度預算
</th>
<th style="text-align:left;">
上年度決算
</th>
<th style="text-align:left;">
預算差
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3100000000
</td>
<td style="text-align:left;">
國務支出
</td>
<td style="text-align:left;">
1210301
</td>
<td style="text-align:left;">
1186955
</td>
<td style="text-align:left;">
1176955.1259999999
</td>
<td style="text-align:left;">
23346
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
3102010000
</td>
<td style="text-align:left;">
總統府
</td>
<td style="text-align:left;">
1004797
</td>
<td style="text-align:left;">
978916
</td>
<td style="text-align:left;">
997305.54599999997
</td>
<td style="text-align:left;">
25881
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
3102100000
</td>
<td style="text-align:left;">
國家安全會議
</td>
<td style="text-align:left;">
205504
</td>
<td style="text-align:left;">
208039
</td>
<td style="text-align:left;">
179649.57999999999
</td>
<td style="text-align:left;">
-2535
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3200000000
</td>
<td style="text-align:left;">
行政支出
</td>
<td style="text-align:left;">
6134276
</td>
<td style="text-align:left;">
5836481
</td>
<td style="text-align:left;">
5477154.5810000002
</td>
<td style="text-align:left;">
297795
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
3203010000
</td>
<td style="text-align:left;">
行政院
</td>
<td style="text-align:left;">
1256043
</td>
<td style="text-align:left;">
1286646
</td>
<td style="text-align:left;">
1268295.23
</td>
<td style="text-align:left;">
-30603
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
3203100000
</td>
<td style="text-align:left;">
主計總處
</td>
<td style="text-align:left;">
1604967
</td>
<td style="text-align:left;">
1478173
</td>
<td style="text-align:left;">
1578781.8940000001
</td>
<td style="text-align:left;">
126794
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3203300000
</td>
<td style="text-align:left;">
人事行政總處
</td>
<td style="text-align:left;">
555363
</td>
<td style="text-align:left;">
573447
</td>
<td style="text-align:left;">
489516.17700000003
</td>
<td style="text-align:left;">
-18084
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
3203340000
</td>
<td style="text-align:left;">
公務人力發展學院
</td>
<td style="text-align:left;">
244346
</td>
<td style="text-align:left;">
239453
</td>
<td style="text-align:left;">
229852.26199999999
</td>
<td style="text-align:left;">
4893
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
3203420000
</td>
<td style="text-align:left;">
檔案管理局
</td>
<td style="text-align:left;">
787429
</td>
<td style="text-align:left;">
646081
</td>
<td style="text-align:left;">
443133.20799999998
</td>
<td style="text-align:left;">
141348
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
3203900000
</td>
<td style="text-align:left;">
大陸委員會
</td>
<td style="text-align:left;">
900896
</td>
<td style="text-align:left;">
900866
</td>
<td style="text-align:left;">
792491.22199999995
</td>
<td style="text-align:left;">
30
</td>
</tr>
</tbody>
</table>
<div id="na處理" class="section level4 hasAnchor" number="6.2.1.1">
<h4><span class="header-section-number">6.2.1.1</span> NA處理<a href="data-manipulation-wity-tidyverse.html#na處理" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>觀察一下現在的資料，發現，行政院、主計總處等均屬於行政支出，但行政支出卻自有一列。依照長表格的格式來說，應嘗試把「款」作為機構的變項。所以將款的數字取代為「行政支出」等支出類別的名稱。</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="data-manipulation-wity-tidyverse.html#cb350-1" aria-hidden="true" tabindex="-1"></a>cleaned <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(款 <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(款), org, 款)) <span class="sc">%&gt;%</span></span>
<span id="cb350-2"><a href="data-manipulation-wity-tidyverse.html#cb350-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
款
</th>
<th style="text-align:left;">
科
</th>
<th style="text-align:left;">
oid
</th>
<th style="text-align:left;">
org
</th>
<th style="text-align:left;">
本年度預算
</th>
<th style="text-align:left;">
上年度預算
</th>
<th style="text-align:left;">
上年度決算
</th>
<th style="text-align:left;">
預算差
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
國務支出
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3100000000
</td>
<td style="text-align:left;">
國務支出
</td>
<td style="text-align:left;">
1210301
</td>
<td style="text-align:left;">
1186955
</td>
<td style="text-align:left;">
1176955.1259999999
</td>
<td style="text-align:left;">
23346
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
3102010000
</td>
<td style="text-align:left;">
總統府
</td>
<td style="text-align:left;">
1004797
</td>
<td style="text-align:left;">
978916
</td>
<td style="text-align:left;">
997305.54599999997
</td>
<td style="text-align:left;">
25881
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
3102100000
</td>
<td style="text-align:left;">
國家安全會議
</td>
<td style="text-align:left;">
205504
</td>
<td style="text-align:left;">
208039
</td>
<td style="text-align:left;">
179649.57999999999
</td>
<td style="text-align:left;">
-2535
</td>
</tr>
<tr>
<td style="text-align:left;">
行政支出
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3200000000
</td>
<td style="text-align:left;">
行政支出
</td>
<td style="text-align:left;">
6134276
</td>
<td style="text-align:left;">
5836481
</td>
<td style="text-align:left;">
5477154.5810000002
</td>
<td style="text-align:left;">
297795
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
3203010000
</td>
<td style="text-align:left;">
行政院
</td>
<td style="text-align:left;">
1256043
</td>
<td style="text-align:left;">
1286646
</td>
<td style="text-align:left;">
1268295.23
</td>
<td style="text-align:left;">
-30603
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
3203100000
</td>
<td style="text-align:left;">
主計總處
</td>
<td style="text-align:left;">
1604967
</td>
<td style="text-align:left;">
1478173
</td>
<td style="text-align:left;">
1578781.8940000001
</td>
<td style="text-align:left;">
126794
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3203300000
</td>
<td style="text-align:left;">
人事行政總處
</td>
<td style="text-align:left;">
555363
</td>
<td style="text-align:left;">
573447
</td>
<td style="text-align:left;">
489516.17700000003
</td>
<td style="text-align:left;">
-18084
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
3203340000
</td>
<td style="text-align:left;">
公務人力發展學院
</td>
<td style="text-align:left;">
244346
</td>
<td style="text-align:left;">
239453
</td>
<td style="text-align:left;">
229852.26199999999
</td>
<td style="text-align:left;">
4893
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
3203420000
</td>
<td style="text-align:left;">
檔案管理局
</td>
<td style="text-align:left;">
787429
</td>
<td style="text-align:left;">
646081
</td>
<td style="text-align:left;">
443133.20799999998
</td>
<td style="text-align:left;">
141348
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
3203900000
</td>
<td style="text-align:left;">
大陸委員會
</td>
<td style="text-align:left;">
900896
</td>
<td style="text-align:left;">
900866
</td>
<td style="text-align:left;">
792491.22199999995
</td>
<td style="text-align:left;">
30
</td>
</tr>
</tbody>
</table>
<p>接下來，希望能夠在「款==<code>NA</code>」的地方填入該欄的「前一個值」例如行政支出。查詢一下（關鍵字如「Fill in NA column values with the last value that was not NA」）還真的有這樣的函式可以操作。</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="data-manipulation-wity-tidyverse.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb351-2"><a href="data-manipulation-wity-tidyverse.html#cb351-2" aria-hidden="true" tabindex="-1"></a>cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb351-3"><a href="data-manipulation-wity-tidyverse.html#cb351-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(款 <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(款), org, 款)) <span class="sc">%&gt;%</span></span>
<span id="cb351-4"><a href="data-manipulation-wity-tidyverse.html#cb351-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(款 <span class="ot">=</span> zoo<span class="sc">::</span><span class="fu">na.locf</span>(款)) <span class="sc">%&gt;%</span></span>
<span id="cb351-5"><a href="data-manipulation-wity-tidyverse.html#cb351-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
款
</th>
<th style="text-align:left;">
科
</th>
<th style="text-align:left;">
oid
</th>
<th style="text-align:left;">
org
</th>
<th style="text-align:left;">
本年度預算
</th>
<th style="text-align:left;">
上年度預算
</th>
<th style="text-align:left;">
上年度決算
</th>
<th style="text-align:left;">
預算差
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
國務支出
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3100000000
</td>
<td style="text-align:left;">
國務支出
</td>
<td style="text-align:left;">
1210301
</td>
<td style="text-align:left;">
1186955
</td>
<td style="text-align:left;">
1176955.1259999999
</td>
<td style="text-align:left;">
23346
</td>
</tr>
<tr>
<td style="text-align:left;">
國務支出
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
3102010000
</td>
<td style="text-align:left;">
總統府
</td>
<td style="text-align:left;">
1004797
</td>
<td style="text-align:left;">
978916
</td>
<td style="text-align:left;">
997305.54599999997
</td>
<td style="text-align:left;">
25881
</td>
</tr>
<tr>
<td style="text-align:left;">
國務支出
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
3102100000
</td>
<td style="text-align:left;">
國家安全會議
</td>
<td style="text-align:left;">
205504
</td>
<td style="text-align:left;">
208039
</td>
<td style="text-align:left;">
179649.57999999999
</td>
<td style="text-align:left;">
-2535
</td>
</tr>
<tr>
<td style="text-align:left;">
行政支出
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3200000000
</td>
<td style="text-align:left;">
行政支出
</td>
<td style="text-align:left;">
6134276
</td>
<td style="text-align:left;">
5836481
</td>
<td style="text-align:left;">
5477154.5810000002
</td>
<td style="text-align:left;">
297795
</td>
</tr>
<tr>
<td style="text-align:left;">
行政支出
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
3203010000
</td>
<td style="text-align:left;">
行政院
</td>
<td style="text-align:left;">
1256043
</td>
<td style="text-align:left;">
1286646
</td>
<td style="text-align:left;">
1268295.23
</td>
<td style="text-align:left;">
-30603
</td>
</tr>
<tr>
<td style="text-align:left;">
行政支出
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
3203100000
</td>
<td style="text-align:left;">
主計總處
</td>
<td style="text-align:left;">
1604967
</td>
<td style="text-align:left;">
1478173
</td>
<td style="text-align:left;">
1578781.8940000001
</td>
<td style="text-align:left;">
126794
</td>
</tr>
<tr>
<td style="text-align:left;">
行政支出
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3203300000
</td>
<td style="text-align:left;">
人事行政總處
</td>
<td style="text-align:left;">
555363
</td>
<td style="text-align:left;">
573447
</td>
<td style="text-align:left;">
489516.17700000003
</td>
<td style="text-align:left;">
-18084
</td>
</tr>
<tr>
<td style="text-align:left;">
行政支出
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
3203340000
</td>
<td style="text-align:left;">
公務人力發展學院
</td>
<td style="text-align:left;">
244346
</td>
<td style="text-align:left;">
239453
</td>
<td style="text-align:left;">
229852.26199999999
</td>
<td style="text-align:left;">
4893
</td>
</tr>
<tr>
<td style="text-align:left;">
行政支出
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
3203420000
</td>
<td style="text-align:left;">
檔案管理局
</td>
<td style="text-align:left;">
787429
</td>
<td style="text-align:left;">
646081
</td>
<td style="text-align:left;">
443133.20799999998
</td>
<td style="text-align:left;">
141348
</td>
</tr>
<tr>
<td style="text-align:left;">
行政支出
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
3203900000
</td>
<td style="text-align:left;">
大陸委員會
</td>
<td style="text-align:left;">
900896
</td>
<td style="text-align:left;">
900866
</td>
<td style="text-align:left;">
792491.22199999995
</td>
<td style="text-align:left;">
30
</td>
</tr>
</tbody>
</table>
<p>太神奇了！看見沒！接下來只要把「科 is <code>NA</code>」的那些該大類支出總數的紀錄給刪除，資料就乾淨了。最後就只會剩下一些資料清理的功伕。完整程式碼可以看下一節。</p>
</div>
<div id="完整程式碼" class="section level4 hasAnchor" number="6.2.1.2">
<h4><span class="header-section-number">6.2.1.2</span> 完整程式碼<a href="data-manipulation-wity-tidyverse.html#完整程式碼" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="data-manipulation-wity-tidyverse.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb352-2"><a href="data-manipulation-wity-tidyverse.html#cb352-2" aria-hidden="true" tabindex="-1"></a><span class="co"># raw &lt;- readxl::read_excel(&quot;data/111B歲出政事別預算總表.xls&quot;)</span></span>
<span id="cb352-3"><a href="data-manipulation-wity-tidyverse.html#cb352-3" aria-hidden="true" tabindex="-1"></a>raw <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;data/111B歲出政事別預算表.xls&quot;</span>, <span class="at">skip=</span><span class="dv">3</span>, <span class="at">col_names =</span> F) </span>
<span id="cb352-4"><a href="data-manipulation-wity-tidyverse.html#cb352-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-5"><a href="data-manipulation-wity-tidyverse.html#cb352-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(raw) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;款&quot;</span>, <span class="st">&quot;科&quot;</span>, <span class="st">&quot;目&quot;</span>, <span class="st">&quot;節&quot;</span>, <span class="st">&quot;機構&quot;</span>, <span class="st">&quot;本年度預算&quot;</span>, <span class="st">&quot;上年度預算&quot;</span>, <span class="st">&quot;上年度決算&quot;</span>, <span class="st">&quot;預算差&quot;</span>)</span>
<span id="cb352-6"><a href="data-manipulation-wity-tidyverse.html#cb352-6" aria-hidden="true" tabindex="-1"></a><span class="co"># raw$款 &lt;- na.locf(raw$款)</span></span>
<span id="cb352-7"><a href="data-manipulation-wity-tidyverse.html#cb352-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-8"><a href="data-manipulation-wity-tidyverse.html#cb352-8" aria-hidden="true" tabindex="-1"></a>cleaned <span class="ot">&lt;-</span> raw <span class="sc">%&gt;%</span></span>
<span id="cb352-9"><a href="data-manipulation-wity-tidyverse.html#cb352-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(款) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(科)) <span class="sc">%&gt;%</span></span>
<span id="cb352-10"><a href="data-manipulation-wity-tidyverse.html#cb352-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb352-11"><a href="data-manipulation-wity-tidyverse.html#cb352-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>目, <span class="sc">-</span>節) <span class="sc">%&gt;%</span></span>
<span id="cb352-12"><a href="data-manipulation-wity-tidyverse.html#cb352-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(機構, <span class="fu">c</span>(<span class="st">&quot;oid&quot;</span>, <span class="st">&quot;org&quot;</span>), <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb352-13"><a href="data-manipulation-wity-tidyverse.html#cb352-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(款 <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(款), org, 款)) <span class="sc">%&gt;%</span></span>
<span id="cb352-14"><a href="data-manipulation-wity-tidyverse.html#cb352-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(款 <span class="ot">=</span> zoo<span class="sc">::</span><span class="fu">na.locf</span>(款)) <span class="sc">%&gt;%</span></span>
<span id="cb352-15"><a href="data-manipulation-wity-tidyverse.html#cb352-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(科)) <span class="sc">%&gt;%</span></span>
<span id="cb352-16"><a href="data-manipulation-wity-tidyverse.html#cb352-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>科) <span class="sc">%&gt;%</span> <span class="fu">type_convert</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb352-17"><a href="data-manipulation-wity-tidyverse.html#cb352-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(上年度預算 <span class="ot">=</span> <span class="fu">as.numeric</span>(上年度預算), </span>
<span id="cb352-18"><a href="data-manipulation-wity-tidyverse.html#cb352-18" aria-hidden="true" tabindex="-1"></a>              上年度決算 <span class="ot">=</span> <span class="fu">as.integer</span>(上年度決算),</span>
<span id="cb352-19"><a href="data-manipulation-wity-tidyverse.html#cb352-19" aria-hidden="true" tabindex="-1"></a>              預算差 <span class="ot">=</span> <span class="fu">as.numeric</span>(預算差)) <span class="sc">%&gt;%</span></span>
<span id="cb352-20"><a href="data-manipulation-wity-tidyverse.html#cb352-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(上年度預算 <span class="ot">=</span> <span class="dv">0</span>, 上年度決算 <span class="ot">=</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb352-21"><a href="data-manipulation-wity-tidyverse.html#cb352-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(預算差 <span class="ot">=</span> 本年度預算 <span class="sc">-</span> 上年度預算)</span></code></pre></div>
</div>
</div>
<div id="對齊資料世界各國疫苗接種比例" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> 對齊資料。世界各國疫苗接種比例<a href="data-manipulation-wity-tidyverse.html#對齊資料世界各國疫苗接種比例" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="https://ourworldindata.org/covid-vaccinations" class="uri">https://ourworldindata.org/covid-vaccinations</a> - <a href="https://github.com/owid/covid-19-data/tree/master/public/data/vaccinations" class="uri">https://github.com/owid/covid-19-data/tree/master/public/data/vaccinations</a></p>
<p>評估資料概況後可發現這個資料集每一列就是某一個國家某一天所上傳的紀錄。所以，一個國家會有很多列。乍聽之下不難處理，但事實上每個國家不會每天上傳、也不會固定某一天上傳、哪一週、哪一個月開始上傳也不一定，也有可能會漏掉一些月份或週次。所以，制定出一個時間單位（例如週、月）、然後延著時間軸將資料「對齊」，讓每個國家在每個時間單位都有資料。但每個國家疫情發展程度不一，所以也不可能有一個完美的對齊，所以通常會建議就所要觀察的國家進行對齊即可。至於想刪除的那些資料列，幾乎都可以當成是所謂的缺失值。</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="data-manipulation-wity-tidyverse.html#cb353-1" aria-hidden="true" tabindex="-1"></a>raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/vaccinations.csv&quot;</span>)</span>
<span id="cb353-2"><a href="data-manipulation-wity-tidyverse.html#cb353-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(raw)</span></code></pre></div>
<pre class="output"><code>## [1] 99442    16</code></pre>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="data-manipulation-wity-tidyverse.html#cb355-1" aria-hidden="true" tabindex="-1"></a>raw <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">20</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
location
</th>
<th style="text-align:left;">
iso_code
</th>
<th style="text-align:left;">
date
</th>
<th style="text-align:right;">
total_vaccinations
</th>
<th style="text-align:right;">
people_vaccinated
</th>
<th style="text-align:right;">
people_fully_vaccinated
</th>
<th style="text-align:right;">
total_boosters
</th>
<th style="text-align:right;">
daily_vaccinations_raw
</th>
<th style="text-align:right;">
daily_vaccinations
</th>
<th style="text-align:right;">
total_vaccinations_per_hundred
</th>
<th style="text-align:right;">
people_vaccinated_per_hundred
</th>
<th style="text-align:right;">
people_fully_vaccinated_per_hundred
</th>
<th style="text-align:right;">
total_boosters_per_hundred
</th>
<th style="text-align:right;">
daily_vaccinations_per_million
</th>
<th style="text-align:right;">
daily_people_vaccinated
</th>
<th style="text-align:right;">
daily_people_vaccinated_per_hundred
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-02-22
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-02-23
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1367
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
1367
</td>
<td style="text-align:right;">
0.003
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-02-24
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1367
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
1367
</td>
<td style="text-align:right;">
0.003
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-02-25
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1367
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
1367
</td>
<td style="text-align:right;">
0.003
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-02-26
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1367
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
1367
</td>
<td style="text-align:right;">
0.003
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-02-27
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1367
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
1367
</td>
<td style="text-align:right;">
0.003
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-02-28
</td>
<td style="text-align:right;">
8200
</td>
<td style="text-align:right;">
8200
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1367
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
1367
</td>
<td style="text-align:right;">
0.003
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-03-01
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1580
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
1580
</td>
<td style="text-align:right;">
0.004
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-03-02
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1794
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1794
</td>
<td style="text-align:right;">
0.005
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-03-03
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
0.005
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-03-04
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2221
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:right;">
2221
</td>
<td style="text-align:right;">
0.006
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-03-05
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2435
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
2435
</td>
<td style="text-align:right;">
0.006
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-03-06
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2649
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
2649
</td>
<td style="text-align:right;">
0.007
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-03-07
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
0.007
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-03-08
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
0.007
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-03-09
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
0.007
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-03-10
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
0.007
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-03-11
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
0.007
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-03-12
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
0.007
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
AFG
</td>
<td style="text-align:left;">
2021-03-13
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
2862
</td>
<td style="text-align:right;">
0.007
</td>
</tr>
</tbody>
</table>
<div id="按月對齊資料" class="section level4 hasAnchor" number="6.2.2.1">
<h4><span class="header-section-number">6.2.2.1</span> 按月對齊資料<a href="data-manipulation-wity-tidyverse.html#按月對齊資料" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>首先要挑選要拿來做視覺化的資料欄位。這邊所選擇的是<code>people_fully_vaccinated_per_hundred</code>，也就是每百人接種二劑疫苗的人數，相當於接種二劑疫苗的百分比。</p>
<p>接下來便是空值處理，如果這個欄位沒有數值的就直接用<code>drop_na()</code>篩除即可。</p>
<p>這個範例希望把該資料視覺化為Y軸為年、X軸為時間的熱區圖。但整個疫情資料橫亙二年多，如果以週為彙整單位的話，那勢必X軸會有近百個資料點。所以打算以「月」為單位來彙整這些資料，因為且資料中也有不少國家缺數週的資料，所以以月為彙整單位是一個權衡後的選擇（仍可以嘗試用週作為彙整單位試試看）。所以，運用了<code>lubridate::floor_date()</code>來將日期資料轉換為月，例如2022-03-12和2022-03-14都會被轉換為2022-03-01。</p>
<p>依照國家與時間群組彙整資料。接下來就依照各國的月份來做彙整（注意，此時會有不少資料同屬於某個月的資料）。彙整的方法是，經過對「日期」（不是對月）做排序後，僅留下第一筆資料，也就是僅留下最接近月份開頭的資料。經由這樣的操作，會使得各國在每個月剛好留下一筆資料，如下面程式的範例輸出。</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="data-manipulation-wity-tidyverse.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb356-2"><a href="data-manipulation-wity-tidyverse.html#cb356-2" aria-hidden="true" tabindex="-1"></a>fullvaccinated <span class="ot">&lt;-</span> raw <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">country =</span> location, date, </span>
<span id="cb356-3"><a href="data-manipulation-wity-tidyverse.html#cb356-3" aria-hidden="true" tabindex="-1"></a>                                people_fully_vaccinated_per_hundred) <span class="sc">%&gt;%</span></span>
<span id="cb356-4"><a href="data-manipulation-wity-tidyverse.html#cb356-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(people_fully_vaccinated_per_hundred) <span class="sc">%&gt;%</span></span>
<span id="cb356-5"><a href="data-manipulation-wity-tidyverse.html#cb356-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">m =</span> <span class="fu">floor_date</span>(date, <span class="at">unit =</span> <span class="st">&quot;month&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb356-6"><a href="data-manipulation-wity-tidyverse.html#cb356-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, m) <span class="sc">%&gt;%</span></span>
<span id="cb356-7"><a href="data-manipulation-wity-tidyverse.html#cb356-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb356-8"><a href="data-manipulation-wity-tidyverse.html#cb356-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb356-9"><a href="data-manipulation-wity-tidyverse.html#cb356-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb356-10"><a href="data-manipulation-wity-tidyverse.html#cb356-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date)</span>
<span id="cb356-11"><a href="data-manipulation-wity-tidyverse.html#cb356-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-12"><a href="data-manipulation-wity-tidyverse.html#cb356-12" aria-hidden="true" tabindex="-1"></a>fullvaccinated <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
people_fully_vaccinated_per_hundred
</th>
<th style="text-align:left;">
m
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:left;">
2021-05-01
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:left;">
2021-06-01
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
0.48
</td>
<td style="text-align:left;">
2021-07-01
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1.08
</td>
<td style="text-align:left;">
2021-08-01
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
8.00
</td>
<td style="text-align:left;">
2021-11-01
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
9.42
</td>
<td style="text-align:left;">
2021-12-01
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
9.56
</td>
<td style="text-align:left;">
2022-01-01
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
9.82
</td>
<td style="text-align:left;">
2022-02-01
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
10.75
</td>
<td style="text-align:left;">
2022-03-01
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
11.38
</td>
<td style="text-align:left;">
2022-04-01
</td>
</tr>
</tbody>
</table>
</div>
<div id="處理遺漏資料的月份" class="section level4 hasAnchor" number="6.2.2.2">
<h4><span class="header-section-number">6.2.2.2</span> 處理遺漏資料的月份<a href="data-manipulation-wity-tidyverse.html#處理遺漏資料的月份" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>接下來要處理的是資料紀錄的缺漏值。每個國家登錄資料的時間是很不一致的，某些國家會缺某些月份，或者某些國家是在某年某月以後才開始登記，或者最近沒在登記。但這個範例所要視覺化的資料是接種疫苗的比例，所以即使是現在沒在登記了，但接種比例應列計最後一次資料紀錄的接種比例。</p>
<p>首先我要讓每個國家都有所有月份，這裡應會有某個函式可以做到這件事，但我沒查到這個函式。不過我可以很技巧性地用<code>pivot_wider()</code>（<code>spread()</code>）和<code>pivot_longer()</code>（<code>gather()</code>）來完成這件事。<code>spread()</code>在展開時對於缺少的資料項可以自動補<code>NA</code>。所以我就只要把資料的月份展開後再<code>gather()</code>回來後，就可以自動讓每個國家所擁有的月份資料一致。以下為<code>spread()</code>後的結果，可以觀察到每一列是一個國家，每一欄是個月份，如果當月都沒資料紀錄，那該月的值就會是空值。可以看見空值是相當多的，也就是在那段時間都沒有資料紀錄。</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="data-manipulation-wity-tidyverse.html#cb357-1" aria-hidden="true" tabindex="-1"></a>fullvaccinated <span class="sc">%&gt;%</span></span>
<span id="cb357-2"><a href="data-manipulation-wity-tidyverse.html#cb357-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(m, people_fully_vaccinated_per_hundred, <span class="at">fill=</span><span class="cn">NA</span>) <span class="sc">%&gt;%</span></span>
<span id="cb357-3"><a href="data-manipulation-wity-tidyverse.html#cb357-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
2020-12-01
</th>
<th style="text-align:right;">
2021-01-01
</th>
<th style="text-align:right;">
2021-02-01
</th>
<th style="text-align:right;">
2021-03-01
</th>
<th style="text-align:right;">
2021-04-01
</th>
<th style="text-align:right;">
2021-05-01
</th>
<th style="text-align:right;">
2021-06-01
</th>
<th style="text-align:right;">
2021-07-01
</th>
<th style="text-align:right;">
2021-08-01
</th>
<th style="text-align:right;">
2021-09-01
</th>
<th style="text-align:right;">
2021-10-01
</th>
<th style="text-align:right;">
2021-11-01
</th>
<th style="text-align:right;">
2021-12-01
</th>
<th style="text-align:right;">
2022-01-01
</th>
<th style="text-align:right;">
2022-02-01
</th>
<th style="text-align:right;">
2022-03-01
</th>
<th style="text-align:right;">
2022-04-01
</th>
<th style="text-align:right;">
2022-05-01
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.14
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.48
</td>
<td style="text-align:right;">
1.08
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
8.00
</td>
<td style="text-align:right;">
9.42
</td>
<td style="text-align:right;">
9.56
</td>
<td style="text-align:right;">
9.82
</td>
<td style="text-align:right;">
10.75
</td>
<td style="text-align:right;">
11.38
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.30
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
1.15
</td>
<td style="text-align:right;">
1.66
</td>
<td style="text-align:right;">
2.86
</td>
<td style="text-align:right;">
4.40
</td>
<td style="text-align:right;">
5.93
</td>
<td style="text-align:right;">
7.24
</td>
<td style="text-align:right;">
9.15
</td>
<td style="text-align:right;">
10.78
</td>
<td style="text-align:right;">
12.30
</td>
<td style="text-align:right;">
15.32
</td>
<td style="text-align:right;">
16.56
</td>
</tr>
<tr>
<td style="text-align:left;">
Albania
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
6.32
</td>
<td style="text-align:right;">
10.21
</td>
<td style="text-align:right;">
14.18
</td>
<td style="text-align:right;">
18.46
</td>
<td style="text-align:right;">
22.58
</td>
<td style="text-align:right;">
27.87
</td>
<td style="text-align:right;">
31.04
</td>
<td style="text-align:right;">
33.62
</td>
<td style="text-align:right;">
36.53
</td>
<td style="text-align:right;">
40.26
</td>
<td style="text-align:right;">
41.73
</td>
<td style="text-align:right;">
42.47
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1.62
</td>
<td style="text-align:right;">
6.72
</td>
<td style="text-align:right;">
10.65
</td>
<td style="text-align:right;">
10.92
</td>
<td style="text-align:right;">
12.45
</td>
<td style="text-align:right;">
12.99
</td>
<td style="text-align:right;">
13.46
</td>
<td style="text-align:right;">
13.70
</td>
<td style="text-align:right;">
14.53
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Andorra
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1.52
</td>
<td style="text-align:right;">
5.80
</td>
<td style="text-align:right;">
6.07
</td>
<td style="text-align:right;">
14.14
</td>
<td style="text-align:right;">
34.92
</td>
<td style="text-align:right;">
45.99
</td>
<td style="text-align:right;">
61.69
</td>
<td style="text-align:right;">
62.45
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
65.07
</td>
<td style="text-align:right;">
68.58
</td>
<td style="text-align:right;">
68.79
</td>
<td style="text-align:right;">
68.99
</td>
<td style="text-align:right;">
69.04
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Angola
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
1.11
</td>
<td style="text-align:right;">
1.66
</td>
<td style="text-align:right;">
2.09
</td>
<td style="text-align:right;">
2.71
</td>
<td style="text-align:right;">
3.57
</td>
<td style="text-align:right;">
5.31
</td>
<td style="text-align:right;">
9.05
</td>
<td style="text-align:right;">
11.77
</td>
<td style="text-align:right;">
14.38
</td>
<td style="text-align:right;">
16.53
</td>
<td style="text-align:right;">
18.06
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Anguilla
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
5.18
</td>
<td style="text-align:right;">
29.25
</td>
<td style="text-align:right;">
36.45
</td>
<td style="text-align:right;">
47.34
</td>
<td style="text-align:right;">
59.27
</td>
<td style="text-align:right;">
59.36
</td>
<td style="text-align:right;">
60.54
</td>
<td style="text-align:right;">
60.54
</td>
<td style="text-align:right;">
60.91
</td>
<td style="text-align:right;">
61.37
</td>
<td style="text-align:right;">
61.82
</td>
<td style="text-align:right;">
63.13
</td>
<td style="text-align:right;">
65.28
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Antigua and Barbuda
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2.61
</td>
<td style="text-align:right;">
18.41
</td>
<td style="text-align:right;">
28.23
</td>
<td style="text-align:right;">
31.33
</td>
<td style="text-align:right;">
35.51
</td>
<td style="text-align:right;">
43.54
</td>
<td style="text-align:right;">
51.60
</td>
<td style="text-align:right;">
57.72
</td>
<td style="text-align:right;">
59.81
</td>
<td style="text-align:right;">
61.27
</td>
<td style="text-align:right;">
62.12
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Argentina
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.26
</td>
<td style="text-align:right;">
0.69
</td>
<td style="text-align:right;">
1.56
</td>
<td style="text-align:right;">
2.24
</td>
<td style="text-align:right;">
6.68
</td>
<td style="text-align:right;">
9.71
</td>
<td style="text-align:right;">
16.35
</td>
<td style="text-align:right;">
34.72
</td>
<td style="text-align:right;">
50.97
</td>
<td style="text-align:right;">
58.37
</td>
<td style="text-align:right;">
67.18
</td>
<td style="text-align:right;">
73.25
</td>
<td style="text-align:right;">
77.69
</td>
<td style="text-align:right;">
80.13
</td>
<td style="text-align:right;">
81.21
</td>
<td style="text-align:right;">
81.64
</td>
</tr>
<tr>
<td style="text-align:left;">
Armenia
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.40
</td>
<td style="text-align:right;">
1.03
</td>
<td style="text-align:right;">
1.74
</td>
<td style="text-align:right;">
3.64
</td>
<td style="text-align:right;">
5.73
</td>
<td style="text-align:right;">
9.33
</td>
<td style="text-align:right;">
17.42
</td>
<td style="text-align:right;">
24.08
</td>
<td style="text-align:right;">
28.94
</td>
<td style="text-align:right;">
31.97
</td>
<td style="text-align:right;">
33.02
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<p>在以下的範例輸出可以看到<code>gather()</code>後的結果。注意，需要照國家和月份來排序後才便於觀察。</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="data-manipulation-wity-tidyverse.html#cb358-1" aria-hidden="true" tabindex="-1"></a>fullvaccinated <span class="sc">%&gt;%</span></span>
<span id="cb358-2"><a href="data-manipulation-wity-tidyverse.html#cb358-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">spread</span>(m, people_fully_vaccinated_per_hundred, <span class="at">fill=</span><span class="cn">NA</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-3"><a href="data-manipulation-wity-tidyverse.html#cb358-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>(month, perc, <span class="sc">-</span>country) <span class="sc">%&gt;%</span> </span>
<span id="cb358-4"><a href="data-manipulation-wity-tidyverse.html#cb358-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(country, month) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">20</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:left;">
month
</th>
<th style="text-align:right;">
perc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2020-12-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-01-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-02-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-03-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-04-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-05-01
</td>
<td style="text-align:right;">
0.14
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-06-01
</td>
<td style="text-align:right;">
0.36
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-07-01
</td>
<td style="text-align:right;">
0.48
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-08-01
</td>
<td style="text-align:right;">
1.08
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-09-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-10-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-11-01
</td>
<td style="text-align:right;">
8.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-12-01
</td>
<td style="text-align:right;">
9.42
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2022-01-01
</td>
<td style="text-align:right;">
9.56
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2022-02-01
</td>
<td style="text-align:right;">
9.82
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2022-03-01
</td>
<td style="text-align:right;">
10.75
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2022-04-01
</td>
<td style="text-align:right;">
11.38
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2022-05-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
2020-12-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
2021-01-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<p>接下來是最技巧性的部分。就接種比例而言是個遞增數列，所以如果這個月有紀錄，但下個月沒紀錄（<code>NA</code>），那下個月的資料應以這個月的資料來替代。此時可以用<code>zoo</code>套件的<code>na.locf()</code>來填<code>NA</code>值，其填<code>NA</code>值的規則是用最後一筆非<code>NA</code>值的資料來替代<code>NA</code>值。但要注意的是，因為資料紀錄可能到第六個月或第七個月才開始紀錄，但在前面的月份都沒資料紀錄，也就是說那些<code>NA</code>值沒有更早的資料紀錄權充填充值。原本<code>na.locf()</code>會把這些找不到參考對象的<code>NA</code>值直接刪除，但我們可以在裡面加一個參數使其不會被刪除（<code>na.locf(perc, na.rm = F)</code>）。</p>
<p>最後，就把這些沒被刪除也沒得參考的早期資料項，用<code>replace_na()</code>填上0即可。</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="data-manipulation-wity-tidyverse.html#cb359-1" aria-hidden="true" tabindex="-1"></a>fullvaccinated <span class="sc">%&gt;%</span></span>
<span id="cb359-2"><a href="data-manipulation-wity-tidyverse.html#cb359-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">spread</span>(m, people_fully_vaccinated_per_hundred, <span class="at">fill=</span><span class="cn">NA</span>) <span class="sc">%&gt;%</span></span>
<span id="cb359-3"><a href="data-manipulation-wity-tidyverse.html#cb359-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>(month, perc, <span class="sc">-</span>country) <span class="sc">%&gt;%</span></span>
<span id="cb359-4"><a href="data-manipulation-wity-tidyverse.html#cb359-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(country, month) <span class="sc">%&gt;%</span></span>
<span id="cb359-5"><a href="data-manipulation-wity-tidyverse.html#cb359-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb359-6"><a href="data-manipulation-wity-tidyverse.html#cb359-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb359-7"><a href="data-manipulation-wity-tidyverse.html#cb359-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc =</span> zoo<span class="sc">::</span><span class="fu">na.locf</span>(perc, <span class="at">na.rm =</span> F)) <span class="sc">%&gt;%</span></span>
<span id="cb359-8"><a href="data-manipulation-wity-tidyverse.html#cb359-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb359-9"><a href="data-manipulation-wity-tidyverse.html#cb359-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(country, month) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:left;">
month
</th>
<th style="text-align:right;">
perc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2020-12-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-01-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-02-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-03-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-04-01
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-05-01
</td>
<td style="text-align:right;">
0.14
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-06-01
</td>
<td style="text-align:right;">
0.36
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-07-01
</td>
<td style="text-align:right;">
0.48
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-08-01
</td>
<td style="text-align:right;">
1.08
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-09-01
</td>
<td style="text-align:right;">
1.08
</td>
</tr>
</tbody>
</table>
<p>最後，就把這些沒被刪除也沒得參考的早期資料項，用<code>replace_na()</code>填上0即可。大功告成。</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="data-manipulation-wity-tidyverse.html#cb360-1" aria-hidden="true" tabindex="-1"></a>fullvaccinated <span class="sc">%&gt;%</span></span>
<span id="cb360-2"><a href="data-manipulation-wity-tidyverse.html#cb360-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">spread</span>(m, people_fully_vaccinated_per_hundred, <span class="at">fill=</span><span class="cn">NA</span>) <span class="sc">%&gt;%</span></span>
<span id="cb360-3"><a href="data-manipulation-wity-tidyverse.html#cb360-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>(month, perc, <span class="sc">-</span>country) <span class="sc">%&gt;%</span></span>
<span id="cb360-4"><a href="data-manipulation-wity-tidyverse.html#cb360-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(country, month) <span class="sc">%&gt;%</span></span>
<span id="cb360-5"><a href="data-manipulation-wity-tidyverse.html#cb360-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb360-6"><a href="data-manipulation-wity-tidyverse.html#cb360-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb360-7"><a href="data-manipulation-wity-tidyverse.html#cb360-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc =</span> zoo<span class="sc">::</span><span class="fu">na.locf</span>(perc, <span class="at">na.rm =</span> F)) <span class="sc">%&gt;%</span></span>
<span id="cb360-8"><a href="data-manipulation-wity-tidyverse.html#cb360-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb360-9"><a href="data-manipulation-wity-tidyverse.html#cb360-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(country, month) <span class="sc">%&gt;%</span></span>
<span id="cb360-10"><a href="data-manipulation-wity-tidyverse.html#cb360-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">perc=</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb360-11"><a href="data-manipulation-wity-tidyverse.html#cb360-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(country, month) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:left;">
month
</th>
<th style="text-align:right;">
perc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2020-12-01
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-01-01
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-02-01
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-03-01
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-04-01
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-05-01
</td>
<td style="text-align:right;">
0.14
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-06-01
</td>
<td style="text-align:right;">
0.36
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-07-01
</td>
<td style="text-align:right;">
0.48
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-08-01
</td>
<td style="text-align:right;">
1.08
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:left;">
2021-09-01
</td>
<td style="text-align:right;">
1.08
</td>
</tr>
</tbody>
</table>
</div>
<div id="完整程式碼-1" class="section level4 hasAnchor" number="6.2.2.3">
<h4><span class="header-section-number">6.2.2.3</span> 完整程式碼<a href="data-manipulation-wity-tidyverse.html#完整程式碼-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="data-manipulation-wity-tidyverse.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb361-2"><a href="data-manipulation-wity-tidyverse.html#cb361-2" aria-hidden="true" tabindex="-1"></a>raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/vaccinations.csv&quot;</span>)</span>
<span id="cb361-3"><a href="data-manipulation-wity-tidyverse.html#cb361-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-4"><a href="data-manipulation-wity-tidyverse.html#cb361-4" aria-hidden="true" tabindex="-1"></a>fullvaccinated <span class="ot">&lt;-</span> raw <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">country =</span> location, date, </span>
<span id="cb361-5"><a href="data-manipulation-wity-tidyverse.html#cb361-5" aria-hidden="true" tabindex="-1"></a>                                people_fully_vaccinated_per_hundred) <span class="sc">%&gt;%</span></span>
<span id="cb361-6"><a href="data-manipulation-wity-tidyverse.html#cb361-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(people_fully_vaccinated_per_hundred) <span class="sc">%&gt;%</span></span>
<span id="cb361-7"><a href="data-manipulation-wity-tidyverse.html#cb361-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">m =</span> <span class="fu">floor_date</span>(date, <span class="at">unit =</span> <span class="st">&quot;month&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb361-8"><a href="data-manipulation-wity-tidyverse.html#cb361-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, m) <span class="sc">%&gt;%</span></span>
<span id="cb361-9"><a href="data-manipulation-wity-tidyverse.html#cb361-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb361-10"><a href="data-manipulation-wity-tidyverse.html#cb361-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb361-11"><a href="data-manipulation-wity-tidyverse.html#cb361-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb361-12"><a href="data-manipulation-wity-tidyverse.html#cb361-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date)</span>
<span id="cb361-13"><a href="data-manipulation-wity-tidyverse.html#cb361-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-14"><a href="data-manipulation-wity-tidyverse.html#cb361-14" aria-hidden="true" tabindex="-1"></a>vperc_by_month <span class="ot">&lt;-</span> fullvaccinated <span class="sc">%&gt;%</span></span>
<span id="cb361-15"><a href="data-manipulation-wity-tidyverse.html#cb361-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(m, people_fully_vaccinated_per_hundred, <span class="at">fill=</span><span class="cn">NA</span>) <span class="sc">%&gt;%</span></span>
<span id="cb361-16"><a href="data-manipulation-wity-tidyverse.html#cb361-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(month, perc, <span class="sc">-</span>country) <span class="sc">%&gt;%</span></span>
<span id="cb361-17"><a href="data-manipulation-wity-tidyverse.html#cb361-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(country, month) <span class="sc">%&gt;%</span></span>
<span id="cb361-18"><a href="data-manipulation-wity-tidyverse.html#cb361-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb361-19"><a href="data-manipulation-wity-tidyverse.html#cb361-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb361-20"><a href="data-manipulation-wity-tidyverse.html#cb361-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> zoo<span class="sc">::</span><span class="fu">na.locf</span>(perc, <span class="at">na.rm =</span> F)) <span class="sc">%&gt;%</span></span>
<span id="cb361-21"><a href="data-manipulation-wity-tidyverse.html#cb361-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb361-22"><a href="data-manipulation-wity-tidyverse.html#cb361-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(country, month) <span class="sc">%&gt;%</span></span>
<span id="cb361-23"><a href="data-manipulation-wity-tidyverse.html#cb361-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">perc=</span><span class="dv">0</span>))</span></code></pre></div>

</div>
</div>
</div>
<div id="categorical" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> 類別資料分析<a href="data-manipulation-wity-tidyverse.html#categorical" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>這個範例涵括了在做問卷分析時常用的處理步驟。最核心的步驟是將文字陳述的類別資料轉換為便於後續運算的<code>factor</code>或數值資料。如果類別數量過多的時候，在這個過程會順便進行重新分組。例如依照年齡組把填答者分為老年、中壯年、青少年、兒童四組。</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="data-manipulation-wity-tidyverse.html#cb362-1" aria-hidden="true" tabindex="-1"></a>raw <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data/tfc_survey.rds&quot;</span>)</span></code></pre></div>
<div id="清理資料" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> 清理資料<a href="data-manipulation-wity-tidyverse.html#清理資料" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>通常問卷會分為兩種類型的資料，一種是人口統計用的基本資料（如性別、年齡組、教育程度）、另一種是問卷本身要問的題項。以下是常見的問卷型態，包含把年齡從20歲開始每五年作為一組，70歲以上則歸類為一組，共會有十一組。而教育程度則常分為五至六組，但在問卷設計的時候，通常會需要增加「拒答」的選項。如果問卷中包含政黨意識形態，就必須要決定要以黨派作為類別變項，或者以意識形態做順序尺度。以下即為一個順序尺度的案例，從「非常接近泛綠」到「非常接近泛藍」共五個等第，但另增「拒答」選項。</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="data-manipulation-wity-tidyverse.html#cb363-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> raw <span class="sc">%&gt;%</span></span>
<span id="cb363-2"><a href="data-manipulation-wity-tidyverse.html#cb363-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">QA3 =</span> <span class="fu">ordered</span>(QA3, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;20-24&quot;</span>, <span class="st">&quot;25-29&quot;</span>, <span class="st">&quot;30-34&quot;</span>, <span class="st">&quot;35-39&quot;</span>, </span>
<span id="cb363-3"><a href="data-manipulation-wity-tidyverse.html#cb363-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;40-44&quot;</span>, <span class="st">&quot;45-49&quot;</span>, <span class="st">&quot;50-54&quot;</span>, <span class="st">&quot;55-59&quot;</span>, </span>
<span id="cb363-4"><a href="data-manipulation-wity-tidyverse.html#cb363-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;60-64&quot;</span>, <span class="st">&quot;65-69&quot;</span>, <span class="st">&quot;70及以上&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb363-5"><a href="data-manipulation-wity-tidyverse.html#cb363-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">QA3_lv =</span> <span class="fu">ordered</span>(QA3, </span>
<span id="cb363-6"><a href="data-manipulation-wity-tidyverse.html#cb363-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;20-24&quot;</span>, <span class="st">&quot;25-29&quot;</span>, <span class="st">&quot;30-34&quot;</span>, <span class="st">&quot;35-39&quot;</span>, </span>
<span id="cb363-7"><a href="data-manipulation-wity-tidyverse.html#cb363-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;40-44&quot;</span>, <span class="st">&quot;45-49&quot;</span>, <span class="st">&quot;50-54&quot;</span>, <span class="st">&quot;55-59&quot;</span>, </span>
<span id="cb363-8"><a href="data-manipulation-wity-tidyverse.html#cb363-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;60-64&quot;</span>, <span class="st">&quot;65-69&quot;</span>, <span class="st">&quot;70及以上&quot;</span>),</span>
<span id="cb363-9"><a href="data-manipulation-wity-tidyverse.html#cb363-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;青年&quot;</span>, <span class="st">&quot;青年&quot;</span>, <span class="st">&quot;壯年&quot;</span>, <span class="st">&quot;壯年&quot;</span>, </span>
<span id="cb363-10"><a href="data-manipulation-wity-tidyverse.html#cb363-10" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;壯年&quot;</span>, <span class="st">&quot;中年&quot;</span>, <span class="st">&quot;中年&quot;</span>, <span class="st">&quot;中年&quot;</span>, </span>
<span id="cb363-11"><a href="data-manipulation-wity-tidyverse.html#cb363-11" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;中年&quot;</span>, <span class="st">&quot;老年&quot;</span>, <span class="st">&quot;老年&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb363-12"><a href="data-manipulation-wity-tidyverse.html#cb363-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">QA4 =</span> <span class="fu">ordered</span>(QA4, </span>
<span id="cb363-13"><a href="data-manipulation-wity-tidyverse.html#cb363-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;拒答&quot;</span>, <span class="st">&quot;國小及以下&quot;</span>, <span class="st">&quot;初中、國中&quot;</span>, </span>
<span id="cb363-14"><a href="data-manipulation-wity-tidyverse.html#cb363-14" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;高中、高職&quot;</span>, <span class="st">&quot;大專（專科與大學）&quot;</span>,</span>
<span id="cb363-15"><a href="data-manipulation-wity-tidyverse.html#cb363-15" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;研究所及以上&quot;</span>), </span>
<span id="cb363-16"><a href="data-manipulation-wity-tidyverse.html#cb363-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;拒答&quot;</span>, <span class="st">&quot;國小以下&quot;</span>, <span class="st">&quot;國中&quot;</span>, </span>
<span id="cb363-17"><a href="data-manipulation-wity-tidyverse.html#cb363-17" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;高中職&quot;</span>, <span class="st">&quot;大專&quot;</span>, <span class="st">&quot;研究所以上&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb363-18"><a href="data-manipulation-wity-tidyverse.html#cb363-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">QASide=</span><span class="fu">ordered</span>(QASide, </span>
<span id="cb363-19"><a href="data-manipulation-wity-tidyverse.html#cb363-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">exclude=</span><span class="st">&quot;拒答&quot;</span>, </span>
<span id="cb363-20"><a href="data-manipulation-wity-tidyverse.html#cb363-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;非常接近泛綠&quot;</span>, <span class="st">&quot;接近泛綠&quot;</span>, </span>
<span id="cb363-21"><a href="data-manipulation-wity-tidyverse.html#cb363-21" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;都不接近&quot;</span>, <span class="st">&quot;接近泛藍&quot;</span>, <span class="st">&quot;非常接近泛藍&quot;</span>)))</span></code></pre></div>
<div id="轉類別變項為factor" class="section level4 hasAnchor" number="6.3.1.1">
<h4><span class="header-section-number">6.3.1.1</span> 轉類別變項為<code>factor</code><a href="data-manipulation-wity-tidyverse.html#轉類別變項為factor" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>在一開始清理資料的時候，會建議先把類別變數（通常是文字型態）轉為<code>factor</code>型態。常用的函式是用<code>mutate()</code>搭配<code>ordered()</code>來改變變數型態。<code>ordered()</code>會照類別順序來標定該<code>factor</code>所對應到的數字。可以用<code>as.integer()</code>將<code>factor</code>轉為整數後就可以看到各類別的順序。</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="data-manipulation-wity-tidyverse.html#cb364-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>QA3[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="output"><code>##  [1] 25-29 35-39 35-39 20-24 45-49 25-29 30-34 20-24 20-24 55-59
## 11 Levels: 20-24 &lt; 25-29 &lt; 30-34 &lt; 35-39 &lt; 40-44 &lt; 45-49 &lt; 50-54 &lt; ... &lt; 70及以上</code></pre>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="data-manipulation-wity-tidyverse.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.integer</span>(dt<span class="sc">$</span>QA3[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code></pre></div>
<pre class="output"><code>##  [1] 2 4 4 1 6 2 3 1 1 8</code></pre>
</div>
<div id="排除某些類別值" class="section level4 hasAnchor" number="6.3.1.2">
<h4><span class="header-section-number">6.3.1.2</span> 排除某些類別值<a href="data-manipulation-wity-tidyverse.html#排除某些類別值" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>如果有某些類別變數的值（如「拒答」）不想被編入<code>factor</code>，可以在<code>reorder()</code>中加入<code>exclude</code>的參數指定不想被編入類別值。</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="data-manipulation-wity-tidyverse.html#cb368-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>QASide[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="output"><code>##  [1] 非常接近泛綠 接近泛藍     接近泛綠     接近泛綠     非常接近泛綠
##  [6] 非常接近泛藍 接近泛綠     接近泛綠     接近泛藍     接近泛綠    
## Levels: 非常接近泛綠 &lt; 接近泛綠 &lt; 都不接近 &lt; 接近泛藍 &lt; 非常接近泛藍</code></pre>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="data-manipulation-wity-tidyverse.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.integer</span>(dt<span class="sc">$</span>QASide[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code></pre></div>
<pre class="output"><code>##  [1] 1 4 2 2 1 5 2 2 4 2</code></pre>
</div>
<div id="群組化類別值" class="section level4 hasAnchor" number="6.3.1.3">
<h4><span class="header-section-number">6.3.1.3</span> 群組化類別值<a href="data-manipulation-wity-tidyverse.html#群組化類別值" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>如果有某些類別變數的類別過多，希望再次群組化為較少的組別，如重新群組各年齡層為青年、壯年、中年與老年四個尺度。此時除了<code>levels</code>參數外，可以另外加入<code>labels</code>的參數，指定每個類別變數值所要對應到的群組。以下為群組後的結果，仔細觀察剩下多少個尺度。</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="data-manipulation-wity-tidyverse.html#cb372-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>QA3[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="output"><code>##  [1] 25-29 35-39 35-39 20-24 45-49 25-29 30-34 20-24 20-24 55-59
## 11 Levels: 20-24 &lt; 25-29 &lt; 30-34 &lt; 35-39 &lt; 40-44 &lt; 45-49 &lt; 50-54 &lt; ... &lt; 70及以上</code></pre>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="data-manipulation-wity-tidyverse.html#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.integer</span>(dt<span class="sc">$</span>QA3[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code></pre></div>
<pre class="output"><code>##  [1] 2 4 4 1 6 2 3 1 1 8</code></pre>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="data-manipulation-wity-tidyverse.html#cb376-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>QA3_lv[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="output"><code>##  [1] 青年 壯年 壯年 青年 中年 青年 壯年 青年 青年 中年
## Levels: 青年 &lt; 壯年 &lt; 中年 &lt; 老年</code></pre>
</div>
</div>
<div id="尺度轉類別指標" class="section level3 hasAnchor" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> 尺度轉類別指標<a href="data-manipulation-wity-tidyverse.html#尺度轉類別指標" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Q7 請問您會不會受到假消息影響？</li>
<li>Q8 請問您認為其他人會不會受到假消息的影響？</li>
</ul>
<p>對於Q7、Q8的問題是詢問填答者認為自己或他人會不會受到假消息影響，並從「一點也不會」、「不會」、「會」到「絕對會」共分四個等第。Q7分別是「81, 446, 650, 39」、Q8分別是「5, 58, 803, 350」。相較於Q7，Q8的分佈略為左傾，亦即傾向於認為其他人較容易受影響。此時如果想要分析Q7和Q8間的關係，由於各有四個等第，其交叉分析表會有16個項目，相當難以分析。</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="data-manipulation-wity-tidyverse.html#cb378-1" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb378-2"><a href="data-manipulation-wity-tidyverse.html#cb378-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Q7 =</span> <span class="fu">ordered</span>(Q7, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;一點也不會&quot;</span>, <span class="st">&quot;不會&quot;</span>, <span class="st">&quot;會&quot;</span>, <span class="st">&quot;絕對會&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb378-3"><a href="data-manipulation-wity-tidyverse.html#cb378-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Q8 =</span> <span class="fu">ordered</span>(Q8, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;一點也不會&quot;</span>, <span class="st">&quot;不會&quot;</span>, <span class="st">&quot;會&quot;</span>, <span class="st">&quot;絕對會&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb378-4"><a href="data-manipulation-wity-tidyverse.html#cb378-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Q7_3rd =</span> <span class="fu">as.numeric</span>(Q8)<span class="sc">-</span><span class="fu">as.numeric</span>(Q7)) <span class="sc">%&gt;%</span></span>
<span id="cb378-5"><a href="data-manipulation-wity-tidyverse.html#cb378-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Q7_3rd_lv =</span> <span class="fu">ifelse</span>(Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;一點也不會&quot;</span>, <span class="st">&quot;不會&quot;</span>) <span class="sc">&amp;</span> Q8 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;會&quot;</span>, <span class="st">&quot;絕對會&quot;</span>), <span class="st">&quot;高&quot;</span>, <span class="st">&quot;低&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb378-6"><a href="data-manipulation-wity-tidyverse.html#cb378-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Q7_3rd_lv =</span> <span class="fu">ordered</span>(Q7_3rd_lv, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;低&quot;</span>, <span class="st">&quot;高&quot;</span>)))</span></code></pre></div>
<p>這時候一種策略是把這兩題視為順序尺度變數，然後把兩題的分數相減。相減後的分數從「-1, 0, 1, 2, 3」各有「12, 482, 600, 103, 19」，不難猜到會是一個較為集中的分佈，後續僅能當作順序尺度或連續變項來分析，不適合找一個閾值轉類別變項。</p>
<p>另一種策略是，分別先把Q7與Q8的「一點也不會」和「不會」群組為「不會」、再把「會」與「絕對會」群組為「會」，這樣Q7與Q8的交叉分析表會變成2X2的分析表，雖然群組數量比較少，但別忘記Q7的填答結果集中在會與不會、而Q8為一個較為偏右的分佈，集中在「會」和「絕對會」。Q8勢必會造成比例不均的分組。</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="data-manipulation-wity-tidyverse.html#cb379-1" aria-hidden="true" tabindex="-1"></a>dt2 <span class="sc">%&gt;%</span> <span class="fu">count</span>(<span class="fu">as.integer</span>(Q8)<span class="sc">-</span><span class="fu">as.integer</span>(Q7))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
as.integer(Q8) - as.integer(Q7)
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
482
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
600
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
103
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
19
</td>
</tr>
</tbody>
</table>
<p>最後這題所採行的策略是，做高、低第三人效果分組，也就是根據認為自己「一點也不會」、「不會」受影響，而他人「會」或「絕對會」受影響的重新群組為「高第三人效果組」，其他則為「低第三人效果組」。亦即，分組的一句是在對自己與他人的認知上，無模糊空間的分組方法（也就是認為自己至少不會，和認為別人應該會）。</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="data-manipulation-wity-tidyverse.html#cb380-1" aria-hidden="true" tabindex="-1"></a>dt2 <span class="sc">%&gt;%</span> <span class="fu">count</span>(Q7_3rd_lv)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Q7_3rd_lv
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
低
</td>
<td style="text-align:right;">
746
</td>
</tr>
<tr>
<td style="text-align:left;">
高
</td>
<td style="text-align:right;">
470
</td>
</tr>
</tbody>
</table>
</div>
<div id="cross-tabulating" class="section level3 hasAnchor" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> Cross-tabulating<a href="data-manipulation-wity-tidyverse.html#cross-tabulating" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="data-manipulation-wity-tidyverse.html#cb381-1" aria-hidden="true" tabindex="-1"></a>(xtb <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span>QA3_lv <span class="sc">+</span> Q7_3rd_lv, <span class="at">data=</span>dt2))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
低
</th>
<th style="text-align:right;">
高
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
青年
</td>
<td style="text-align:right;">
178
</td>
<td style="text-align:right;">
110
</td>
</tr>
<tr>
<td style="text-align:left;">
壯年
</td>
<td style="text-align:right;">
370
</td>
<td style="text-align:right;">
199
</td>
</tr>
<tr>
<td style="text-align:left;">
中年
</td>
<td style="text-align:right;">
157
</td>
<td style="text-align:right;">
134
</td>
</tr>
<tr>
<td style="text-align:left;">
老年
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
27
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="data-manipulation-wity-tidyverse.html#cb382-1" aria-hidden="true" tabindex="-1"></a>(chi2 <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(xtb))</span></code></pre></div>
<pre class="output"><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  xtb
## X-squared = 10.017, df = 3, p-value = 0.01842</code></pre>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="data-manipulation-wity-tidyverse.html#cb384-1" aria-hidden="true" tabindex="-1"></a>vcd<span class="sc">::</span><span class="fu">assocstats</span>(xtb)</span></code></pre></div>
<pre class="output"><code>##                      X^2 df P(&gt; X^2)
## Likelihood Ratio  9.9301  3  0.01917
## Pearson          10.0173  3  0.01842
## 
## Phi-Coefficient   : NA 
## Contingency Coeff.: 0.09 
## Cramer&#39;s V        : 0.091</code></pre>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="data-manipulation-wity-tidyverse.html#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(chi2<span class="sc">$</span>observed, <span class="dv">2</span>))</span></code></pre></div>
<pre class="output"><code>##       Q7_3rd_lv
## QA3_lv  低  高
##   青年 178 110
##   壯年 370 199
##   中年 157 134
##   老年  41  27</code></pre>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="data-manipulation-wity-tidyverse.html#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(chi2<span class="sc">$</span>expected, <span class="dv">2</span>))</span></code></pre></div>
<pre class="output"><code>##       Q7_3rd_lv
## QA3_lv     低     高
##   青年 176.68 111.32
##   壯年 349.07 219.93
##   中年 178.52 112.48
##   老年  41.72  26.28</code></pre>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="data-manipulation-wity-tidyverse.html#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(chi2<span class="sc">$</span>residuals, <span class="dv">2</span>))</span></code></pre></div>
<pre class="output"><code>##       Q7_3rd_lv
## QA3_lv    低    高
##   青年  0.10 -0.12
##   壯年  1.12 -1.41
##   中年 -1.61  2.03
##   老年 -0.11  0.14</code></pre>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="data-manipulation-wity-tidyverse.html#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">family=</span><span class="st">&quot;Heiti TC Light&quot;</span>)</span>
<span id="cb392-2"><a href="data-manipulation-wity-tidyverse.html#cb392-2" aria-hidden="true" tabindex="-1"></a>gplots<span class="sc">::</span><span class="fu">balloonplot</span>(<span class="fu">t</span>(xtb), <span class="at">xlab=</span><span class="st">&quot;第三人效果&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;年齡組&quot;</span>, <span class="at">main=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb392-3"><a href="data-manipulation-wity-tidyverse.html#cb392-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">dotsize=</span><span class="dv">4</span><span class="sc">/</span><span class="fu">max</span>(<span class="fu">strwidth</span>(<span class="dv">40</span>),<span class="fu">strheight</span>(<span class="dv">40</span>)),</span>
<span id="cb392-4"><a href="data-manipulation-wity-tidyverse.html#cb392-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">text.size=</span><span class="fl">1.5</span>,<span class="at">label.size=</span><span class="dv">2</span>,</span>
<span id="cb392-5"><a href="data-manipulation-wity-tidyverse.html#cb392-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">rowmar=</span><span class="dv">1</span>, <span class="at">colmar=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="R-for-Data-Journalism_files/figure-html/unnamed-chunk-120-1.png" width="672" /></p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="data-manipulation-wity-tidyverse.html#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">family=</span><span class="st">&quot;Heiti TC Light&quot;</span>)</span>
<span id="cb393-2"><a href="data-manipulation-wity-tidyverse.html#cb393-2" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(chi2<span class="sc">$</span>residuals, <span class="at">is.corr =</span> F)</span></code></pre></div>
<p><img src="R-for-Data-Journalism_files/figure-html/unnamed-chunk-120-2.png" width="672" /></p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="data-manipulation-wity-tidyverse.html#cb394-1" aria-hidden="true" tabindex="-1"></a>xtb <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb394-2"><a href="data-manipulation-wity-tidyverse.html#cb394-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(QA3_lv) <span class="sc">%&gt;%</span></span>
<span id="cb394-3"><a href="data-manipulation-wity-tidyverse.html#cb394-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fill =</span> <span class="fu">if_else</span>(n <span class="sc">==</span> <span class="fu">max</span>(n), <span class="st">&quot;orangered&quot;</span>, <span class="st">&quot;skyblue&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb394-4"><a href="data-manipulation-wity-tidyverse.html#cb394-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb394-5"><a href="data-manipulation-wity-tidyverse.html#cb394-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">QA3_lv =</span> <span class="fu">ordered</span>(QA3_lv, </span>
<span id="cb394-6"><a href="data-manipulation-wity-tidyverse.html#cb394-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;青年&quot;</span>, <span class="st">&quot;壯年&quot;</span>, <span class="st">&quot;中年&quot;</span>, <span class="st">&quot;老年&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb394-7"><a href="data-manipulation-wity-tidyverse.html#cb394-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(QA3_lv)) <span class="sc">%&gt;%</span></span>
<span id="cb394-8"><a href="data-manipulation-wity-tidyverse.html#cb394-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">y =</span> QA3_lv, <span class="at">x=</span>Q7_3rd_lv, <span class="at">color =</span> fill, <span class="at">size =</span> n) <span class="sc">+</span> </span>
<span id="cb394-9"><a href="data-manipulation-wity-tidyverse.html#cb394-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_area</span>(<span class="at">max_size=</span><span class="dv">70</span>, <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb394-10"><a href="data-manipulation-wity-tidyverse.html#cb394-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb394-11"><a href="data-manipulation-wity-tidyverse.html#cb394-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;orangered&quot;</span>, <span class="st">&quot;skyblue&quot;</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span> </span>
<span id="cb394-12"><a href="data-manipulation-wity-tidyverse.html#cb394-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(</span>
<span id="cb394-13"><a href="data-manipulation-wity-tidyverse.html#cb394-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">label=</span>n, </span>
<span id="cb394-14"><a href="data-manipulation-wity-tidyverse.html#cb394-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust=</span><span class="fl">1.3</span>,</span>
<span id="cb394-15"><a href="data-manipulation-wity-tidyverse.html#cb394-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">size=</span><span class="dv">10</span></span>
<span id="cb394-16"><a href="data-manipulation-wity-tidyverse.html#cb394-16" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">color=</span><span class="st">&quot;black&quot;</span>,) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb394-17"><a href="data-manipulation-wity-tidyverse.html#cb394-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family=</span><span class="st">&quot;Heiti TC Light&quot;</span>),</span>
<span id="cb394-18"><a href="data-manipulation-wity-tidyverse.html#cb394-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">family=</span><span class="st">&quot;Heiti TC Light&quot;</span>))</span></code></pre></div>
<p><img src="R-for-Data-Journalism_files/figure-html/unnamed-chunk-121-1.png" width="672" /></p>

</div>
</div>
<div id="時間軸的視覺化" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> 時間軸的視覺化<a href="data-manipulation-wity-tidyverse.html#時間軸的視覺化" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="data-manipulation-wity-tidyverse.html#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb395-2"><a href="data-manipulation-wity-tidyverse.html#cb395-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb395-3"><a href="data-manipulation-wity-tidyverse.html#cb395-3" aria-hidden="true" tabindex="-1"></a><span class="co"># options(stringsAsFactors = F) # default option in R &gt; 4.0</span></span></code></pre></div>
<div id="文字轉時間" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> 文字轉時間<a href="data-manipulation-wity-tidyverse.html#文字轉時間" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Convert “character time” to R date.time object (POSIXct)</li>
</ul>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="data-manipulation-wity-tidyverse.html#cb396-1" aria-hidden="true" tabindex="-1"></a>ptturl <span class="ot">&lt;-</span> <span class="st">&quot;https://github.com/P4CSS/R4CSSData/raw/main/ptt_hang_posts.csv&quot;</span></span>
<span id="cb396-2"><a href="data-manipulation-wity-tidyverse.html#cb396-2" aria-hidden="true" tabindex="-1"></a>raw <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">url</span>(ptturl))</span>
<span id="cb396-3"><a href="data-manipulation-wity-tidyverse.html#cb396-3" aria-hidden="true" tabindex="-1"></a>clean <span class="ot">&lt;-</span> raw <span class="sc">%&gt;%</span></span>
<span id="cb396-4"><a href="data-manipulation-wity-tidyverse.html#cb396-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">ptime =</span> <span class="fu">as.POSIXct</span>(<span class="fu">strptime</span>(ptime, <span class="st">&quot;%Y-%m-%dT%H:%M:%SZ&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;ASIA/Taipeiw&quot;</span>)))</span>
<span id="cb396-5"><a href="data-manipulation-wity-tidyverse.html#cb396-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb396-6"><a href="data-manipulation-wity-tidyverse.html#cb396-6" aria-hidden="true" tabindex="-1"></a>raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">url</span>(ptturl))</span>
<span id="cb396-7"><a href="data-manipulation-wity-tidyverse.html#cb396-7" aria-hidden="true" tabindex="-1"></a>?read_csv</span></code></pre></div>
<div class="r-help-page">
<div class="container">
<table style="width: 100%;">
<tr>
<td>
read_delim
</td>
<td style="text-align: right;">
R Documentation
</td>
</tr>
</table>
<h2>
Read a delimited file (including CSV and TSV) into a tibble
</h2>
<h3>
Description
</h3>
<p>
<code>read_csv()</code> and <code>read_tsv()</code> are special cases of the more general
<code>read_delim()</code>. They’re useful for reading the most common types of
flat file data, comma separated values and tab separated values,
respectively. <code>read_csv2()</code> uses <code style="white-space: pre;">⁠;⁠</code> for the field separator and <code style="white-space: pre;">⁠,⁠</code> for the
decimal point. This format is common in some European countries.
</p>
<h3>
Usage
</h3>
<pre class="r"><code class='language-R'>read_delim(
  file,
  delim = NULL,
  quote = "\"",
  escape_backslash = FALSE,
  escape_double = TRUE,
  col_names = TRUE,
  col_types = NULL,
  col_select = NULL,
  id = NULL,
  locale = default_locale(),
  na = c("", "NA"),
  quoted_na = TRUE,
  comment = "",
  trim_ws = FALSE,
  skip = 0,
  n_max = Inf,
  guess_max = min(1000, n_max),
  name_repair = "unique",
  num_threads = readr_threads(),
  progress = show_progress(),
  show_col_types = should_show_types(),
  skip_empty_rows = TRUE,
  lazy = should_read_lazy()
)

read_csv(
  file,
  col_names = TRUE,
  col_types = NULL,
  col_select = NULL,
  id = NULL,
  locale = default_locale(),
  na = c("", "NA"),
  quoted_na = TRUE,
  quote = "\"",
  comment = "",
  trim_ws = TRUE,
  skip = 0,
  n_max = Inf,
  guess_max = min(1000, n_max),
  name_repair = "unique",
  num_threads = readr_threads(),
  progress = show_progress(),
  show_col_types = should_show_types(),
  skip_empty_rows = TRUE,
  lazy = should_read_lazy()
)

read_csv2(
  file,
  col_names = TRUE,
  col_types = NULL,
  col_select = NULL,
  id = NULL,
  locale = default_locale(),
  na = c("", "NA"),
  quoted_na = TRUE,
  quote = "\"",
  comment = "",
  trim_ws = TRUE,
  skip = 0,
  n_max = Inf,
  guess_max = min(1000, n_max),
  progress = show_progress(),
  name_repair = "unique",
  num_threads = readr_threads(),
  show_col_types = should_show_types(),
  skip_empty_rows = TRUE,
  lazy = should_read_lazy()
)

read_tsv(
  file,
  col_names = TRUE,
  col_types = NULL,
  col_select = NULL,
  id = NULL,
  locale = default_locale(),
  na = c("", "NA"),
  quoted_na = TRUE,
  quote = "\"",
  comment = "",
  trim_ws = TRUE,
  skip = 0,
  n_max = Inf,
  guess_max = min(1000, n_max),
  progress = show_progress(),
  name_repair = "unique",
  num_threads = readr_threads(),
  show_col_types = should_show_types(),
  skip_empty_rows = TRUE,
  lazy = should_read_lazy()
)
</code></pre>
<h3>
Arguments
</h3>
<table>
<tr style="vertical-align: top;">
<td>
<code>file</code>
</td>
<td>
<p>
Either a path to a file, a connection, or literal data
(either a single string or a raw vector).
</p>
<p>
Files ending in <code>.gz</code>, <code>.bz2</code>, <code>.xz</code>, or <code>.zip</code> will
be automatically uncompressed. Files starting with <code style="white-space: pre;">⁠<a href="http://&amp;#8288" class="uri">http://&amp;#8288</a>;</code>,
<code style="white-space: pre;">⁠<a href="https://&amp;#8288" class="uri">https://&amp;#8288</a>;</code>, <code style="white-space: pre;">⁠<a href="ftp://&amp;#8288" class="uri">ftp://&amp;#8288</a>;</code>, or <code style="white-space: pre;">⁠ftps://⁠</code> will be automatically
downloaded. Remote gz files can also be automatically downloaded and
decompressed.
</p>
<p>
Literal data is most useful for examples and tests. To be recognised as
literal data, the input must be either wrapped with <code>I()</code>, be a string
containing at least one new line, or be a vector containing at least one
string with a new line.
</p>
<p>
Using a value of <code>clipboard()</code> will read from the system clipboard.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>delim</code>
</td>
<td>
<p>
Single character used to separate fields within a record.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>quote</code>
</td>
<td>
<p>
Single character used to quote strings.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>escape_backslash</code>
</td>
<td>
<p>
Does the file use backslashes to escape special
characters? This is more general than <code>escape_double</code> as backslashes
can be used to escape the delimiter character, the quote character, or
to add special characters like <code style="white-space: pre;">⁠\n⁠</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>escape_double</code>
</td>
<td>
<p>
Does the file escape quotes by doubling them?
i.e. If this option is <code>TRUE</code>, the value <code style="white-space: pre;">⁠““““⁠</code> represents
a single quote, <code style="white-space: pre;">⁠"⁠</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>col_names</code>
</td>
<td>
<p>
Either <code>TRUE</code>, <code>FALSE</code> or a character vector
of column names.
</p>
<p>
If <code>TRUE</code>, the first row of the input will be used as the column
names, and will not be included in the data frame. If <code>FALSE</code>, column
names will be generated automatically: X1, X2, X3 etc.
</p>
<p>
If <code>col_names</code> is a character vector, the values will be used as the
names of the columns, and the first row of the input will be read into
the first row of the output data frame.
</p>
<p>
Missing (<code>NA</code>) column names will generate a warning, and be filled
in with dummy names <code>…1</code>, <code>…2</code> etc. Duplicate column names
will generate a warning and be made unique, see <code>name_repair</code> to control
how this is done.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>col_types</code>
</td>
<td>
<p>
One of <code>NULL</code>, a <code>cols()</code> specification, or
a string. See <code>vignette(“readr”)</code> for more details.
</p>
<p>
If <code>NULL</code>, all column types will be imputed from <code>guess_max</code> rows
on the input interspersed throughout the file. This is convenient (and
fast), but not robust. If the imputation fails, you’ll need to increase
the <code>guess_max</code> or supply the correct types yourself.
</p>
<p>
Column specifications created by <code>list()</code> or <code>cols()</code> must contain
one column specification for each column. If you only want to read a
subset of the columns, use <code>cols_only()</code>.
</p>
<p>
Alternatively, you can use a compact string representation where each
character represents one column:
</p>
<ul>
<li>
<p>
c = character
</p>
</li>
<li>
<p>
i = integer
</p>
</li>
<li>
<p>
n = number
</p>
</li>
<li>
<p>
d = double
</p>
</li>
<li>
<p>
l = logical
</p>
</li>
<li>
<p>
f = factor
</p>
</li>
<li>
<p>
D = date
</p>
</li>
<li>
<p>
T = date time
</p>
</li>
<li>
<p>
t = time
</p>
</li>
<li>
<p>
? = guess
</p>
</li>
<li>
<p>
_ or - = skip
</p>
<p>
By default, reading a file without a column specification will print a
message showing what <code>readr</code> guessed they were. To remove this message,
set <code>show_col_types = FALSE</code> or set ’options(readr.show_col_types = FALSE).
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>col_select</code>
</td>
<td>
<p>
Columns to include in the results. You can use the same
mini-language as <code>dplyr::select()</code> to refer to the columns by name. Use
<code>c()</code> or <code>list()</code> to use more than one selection expression. Although this
usage is less common, <code>col_select</code> also accepts a numeric column index. See
<code>?tidyselect::language</code> for full details on the
selection language.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>id</code>
</td>
<td>
<p>
The name of a column in which to store the file path. This is
useful when reading multiple input files and there is data in the file
paths, such as the data collection date. If <code>NULL</code> (the default) no extra
column is created.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>locale</code>
</td>
<td>
<p>
The locale controls defaults that vary from place to place.
The default locale is US-centric (like R), but you can use
<code>locale()</code> to create your own locale that controls things like
the default time zone, encoding, decimal mark, big mark, and day/month
names.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>na</code>
</td>
<td>
<p>
Character vector of strings to interpret as missing values. Set this
option to <code>character()</code> to indicate no missing values.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>quoted_na</code>
</td>
<td>
<p>
<a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt='[Deprecated]' /></a> Should missing values
inside quotes be treated as missing values (the default) or strings. This
parameter is soft deprecated as of readr 2.0.0.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>comment</code>
</td>
<td>
<p>
A string used to identify comments. Any text after the
comment characters will be silently ignored.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>trim_ws</code>
</td>
<td>
<p>
Should leading and trailing whitespace (ASCII spaces and tabs) be trimmed from
each field before parsing it?
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>skip</code>
</td>
<td>
<p>
Number of lines to skip before reading data. If <code>comment</code> is
supplied any commented lines are ignored <em>after</em> skipping.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>n_max</code>
</td>
<td>
<p>
Maximum number of lines to read.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>guess_max</code>
</td>
<td>
<p>
Maximum number of lines to use for guessing column types.
See <code>vignette(“column-types”, package = “readr”)</code> for more details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>name_repair</code>
</td>
<td>
<p>
Handling of column names. The default behaviour is to
ensure column names are <code>“unique”</code>. Various repair strategies are
supported:
</p>
<ul>
<li>
<p>
<code>“minimal”</code>: No name repair or checks, beyond basic existence of names.
</p>
</li>
<li>
<p>
<code>“unique”</code> (default value): Make sure names are unique and not empty.
</p>
</li>
<li>
<p>
<code>“check_unique”</code>: no name repair, but check they are <code>unique</code>.
</p>
</li>
<li>
<p>
<code>“universal”</code>: Make the names <code>unique</code> and syntactic.
</p>
</li>
<li>
<p>
A function: apply custom name repair (e.g., <code>name_repair = make.names</code>
for names in the style of base R).
</p>
</li>
<li>
<p>
A purrr-style anonymous function, see <code>rlang::as_function()</code>.
</p>
</li>
</ul>
<p>
This argument is passed on as <code>repair</code> to <code>vctrs::vec_as_names()</code>.
See there for more details on these terms and the strategies used
to enforce them.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>num_threads</code>
</td>
<td>
<p>
The number of processing threads to use for initial
parsing and lazy reading of data. If your data contains newlines within
fields the parser should automatically detect this and fall back to using
one thread only. However if you know your file has newlines within quoted
fields it is safest to set <code>num_threads = 1</code> explicitly.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>progress</code>
</td>
<td>
<p>
Display a progress bar? By default it will only display
in an interactive session and not while knitting a document. The automatic
progress bar can be disabled by setting option <code>readr.show_progress</code> to
<code>FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>show_col_types</code>
</td>
<td>
<p>
If <code>FALSE</code>, do not show the guessed column types. If
<code>TRUE</code> always show the column types, even if they are supplied. If <code>NULL</code>
(the default) only show the column types if they are not explicitly supplied
by the <code>col_types</code> argument.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>skip_empty_rows</code>
</td>
<td>
<p>
Should blank rows be ignored altogether? i.e. If this
option is <code>TRUE</code> then blank rows will not be represented at all. If it is
<code>FALSE</code> then they will be represented by <code>NA</code> values in all the columns.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>lazy</code>
</td>
<td>
<p>
Read values lazily? By default the file is initially only
indexed and the values are read lazily when accessed. Lazy reading is
useful interactively, particularly if you are only interested in a subset
of the full dataset. <em>Note</em>, if you later write to the same file you read
from you need to set <code>lazy = FALSE</code>. On Windows the file will be locked
and on other systems the memory map will become invalid.
</p>
</td>
</tr>
</table>
<h3>
Value
</h3>
<p>
A <code>tibble()</code>. If there are parsing problems, a warning will alert you.
You can retrieve the full details by calling <code>problems()</code> on your dataset.
</p>
<h3>
Examples
</h3>
<pre class="r"><code class='language-R'># Input sources -------------------------------------------------------------
# Read from a path
read_csv(readr_example("mtcars.csv"))
read_csv(readr_example("mtcars.csv.zip"))
read_csv(readr_example("mtcars.csv.bz2"))
## Not run: 
# Including remote paths
read_csv("https://github.com/tidyverse/readr/raw/main/inst/extdata/mtcars.csv")

## End(Not run)

# Or directly from a string with `I()`
read_csv(I("x,y\n1,2\n3,4"))

# Column types --------------------------------------------------------------
# By default, readr guesses the columns types, looking at `guess_max` rows.
# You can override with a compact specification:
read_csv(I("x,y\n1,2\n3,4"), col_types = "dc")

# Or with a list of column types:
read_csv(I("x,y\n1,2\n3,4"), col_types = list(col_double(), col_character()))

# If there are parsing problems, you get a warning, and can extract
# more details with problems()
y &lt;- read_csv(I("x\n1\n2\nb"), col_types = list(col_double()))
y
problems(y)

# File types ----------------------------------------------------------------
read_csv(I("a,b\n1.0,2.0"))
read_csv2(I("a;b\n1,0;2,0"))
read_tsv(I("a\tb\n1.0\t2.0"))
read_delim(I("a|b\n1.0|2.0"), delim = "|")
</code></pre>
</div>
</div>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="data-manipulation-wity-tidyverse.html#cb397-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="st">&quot;2019-04-12T00:48:19Z&quot;</span></span>
<span id="cb397-2"><a href="data-manipulation-wity-tidyverse.html#cb397-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(t)</span></code></pre></div>
<pre class="output"><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="data-manipulation-wity-tidyverse.html#cb399-1" aria-hidden="true" tabindex="-1"></a>?strptime</span></code></pre></div>
<div class="r-help-page">
<div class="container">
<table style="width: 100%;">
<tr>
<td>
strptime
</td>
<td style="text-align: right;">
R Documentation
</td>
</tr>
</table>
<h2>
Date-time Conversion Functions to and from Character
</h2>
<h3>
Description
</h3>
<p>
Functions to convert between character representations and objects of
classes <code>“POSIXlt”</code> and <code>“POSIXct”</code> representing calendar
dates and times.
</p>
<h3>
Usage
</h3>
<pre class="r"><code class='language-R'>## S3 method for class 'POSIXct'
format(x, format = "", tz = "", usetz = FALSE, ...)
## S3 method for class 'POSIXlt'
format(x, format = "", usetz = FALSE,
       digits = getOption("digits.secs"), ...)

## S3 method for class 'POSIXt'
as.character(x, ...)

strftime(x, format = "", tz = "", usetz = FALSE, ...)
strptime(x, format, tz = "")
</code></pre>
<h3>
Arguments
</h3>
<table>
<tr style="vertical-align: top;">
<td>
<code>x</code>
</td>
<td>
<p>
An object to be converted: a character vector for
<code>strptime</code>, an object which can be converted to
<code>“POSIXlt”</code> for <code>strftime</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>tz</code>
</td>
<td>
<p>
A character string specifying the time zone to be used for
the conversion. System-specific (see <code>as.POSIXlt</code>), but
<code>““</code> is the current time zone, and <code>”GMT”</code> is UTC.
Invalid values are most commonly treated as UTC, on some platforms with
a warning.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>format</code>
</td>
<td>
<p>
A character string. The default for the <code>format</code>
methods is
<code>“%Y-%m-%d %H:%M:%S”</code> if any element has a time
component which is not midnight, and <code>“%Y-%m-%d”</code>
otherwise. If <code>options(“digits.secs”)</code> is set, up to
the specified number of digits will be printed for seconds.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>…</code>
</td>
<td>
<p>
Further arguments to be passed from or to other methods.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>usetz</code>
</td>
<td>
<p>
logical. Should the time zone abbreviation be appended
to the output? This is used in printing times, and more reliable
than using <code>“%Z”</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>digits</code>
</td>
<td>
<p>
integer determining the <code>format()</code>ing of seconds when needed.
</p>
</td>
</tr>
</table>
<h3>
Details
</h3>
<p>
The <code>format</code> and <code>as.character</code> methods and <code>strftime</code>
convert objects from the classes <code>“POSIXlt”</code> and
<code>“POSIXct”</code> to character vectors.
</p>
<p>
<code>strptime</code> converts character vectors to class <code>“POSIXlt”</code>:
its input <code>x</code> is first converted by <code>as.character</code>.
Each input string is processed as far as necessary for the format
specified: any trailing characters are ignored.
</p>
<p>
<code>strftime</code> is a wrapper for <code>format.POSIXlt</code>, and it and
<code>format.POSIXct</code> first convert to class <code>“POSIXlt”</code> by
calling <code>as.POSIXlt</code> (so they also work for class
<code>“Date”</code>). Note that only that conversion depends on the
time zone.
Since <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> version 4.2.0, that <code>as.POSIXlt()</code> conversion now treats
the non-finite numeric <code>-Inf</code>, <code>Inf</code>, <code>NA</code> and <code>NaN</code>
differently (where previously all were treated as <code>NA</code>) and also
the <code>format()</code> method for <code>POSIXlt</code> now treats these different
non-finite times and dates analogously to type <code>double</code>.
</p>
<p>
The usual vector re-cycling rules are applied to <code>x</code> and
<code>format</code> so the answer will be of length of the longer of these
vectors.
</p>
<p>
Locale-specific conversions to and from character strings are used
where appropriate and available. This affects the names of the days
and months, the AM/PM indicator (if used) and the separators in output
formats such as <code>%x</code> and <code>%X</code>, <em>via</em> the setting of
the <code>LC_TIME</code> locale category. The ‘current
locale’ of the descriptions might mean the locale in use at the start
of the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> session or when these functions are first used. (For input,
the locale-specific conversions can be changed by calling
<code>Sys.setlocale</code> with category <code>LC_TIME</code> (or
<code>LC_ALL</code>). For output, what happens depends on the OS but
usually works.)
</p>
<p>
The details of the formats are platform-specific, but the following are
likely to be widely available: most are defined by the POSIX standard.
A <em>conversion specification</em> is introduced by <code>%</code>, usually
followed by a single letter or <code>O</code> or <code>E</code> and then a single
letter. Any character in the format string not part of a conversion
specification is interpreted literally (and <code>%%</code> gives
<code>%</code>). Widely implemented conversion specifications include
</p>
<dl>
<dt>
<code>%a</code>
</dt>
<dd>
<p>
Abbreviated weekday name in the current
locale on this platform. (Also matches full name on input:
in some locales there are no abbreviations of names.)
</p>
</dd>
<dt>
<code>%A</code>
</dt>
<dd>
<p>
Full weekday name in the current locale. (Also
matches abbreviated name on input.)
</p>
</dd>
<dt>
<code>%b</code>
</dt>
<dd>
<p>
Abbreviated month name in the current locale on
this platform. (Also matches full name on input: in
some locales there are no abbreviations of names.)
</p>
</dd>
<dt>
<code>%B</code>
</dt>
<dd>
<p>
Full month name in the current locale. (Also
matches abbreviated name on input.)
</p>
</dd>
<dt>
<code>%c</code>
</dt>
<dd>
<p>
Date and time. Locale-specific on output,
<code>“%a %b %e %H:%M:%S %Y”</code> on input.
</p>
</dd>
<dt>
<code>%C</code>
</dt>
<dd>
<p>
Century (00–99): the integer part of the year
divided by 100.
</p>
</dd>
<dt>
<code>%d</code>
</dt>
<dd>
<p>
Day of the month as decimal number (01–31).
</p>
</dd>
<dt>
<code>%D</code>
</dt>
<dd>
<p>
Date format such as <code>%m/%d/%y</code>: the C99
standard says it should be that exact format (but not all OSes
comply).
</p>
</dd>
<dt>
<code>%e</code>
</dt>
<dd>
<p>
Day of the month as decimal number (1–31), with
a leading space for a single-digit number.
</p>
</dd>
<dt>
<code>%F</code>
</dt>
<dd>
<p>
Equivalent to %Y-%m-%d (the ISO 8601 date
format).
</p>
</dd>
<dt>
<code>%g</code>
</dt>
<dd>
<p>
The last two digits of the week-based year
(see <code>%V</code>). (Accepted but ignored on input.)
</p>
</dd>
<dt>
<code>%G</code>
</dt>
<dd>
<p>
The week-based year (see <code>%V</code>) as a decimal
number. (Accepted but ignored on input.)
</p>
</dd>
<dt>
<code>%h</code>
</dt>
<dd>
<p>
Equivalent to <code>%b</code>.
</p>
</dd>
<dt>
<code>%H</code>
</dt>
<dd>
<p>
Hours as decimal number (00–23). As a special
exception strings such as ‘<span class="samp">⁠24:00:00⁠</span>’ are accepted for input,
since ISO 8601 allows these.
</p>
</dd>
<dt>
<code>%I</code>
</dt>
<dd>
<p>
Hours as decimal number (01–12).
</p>
</dd>
<dt>
<code>%j</code>
</dt>
<dd>
<p>
Day of year as decimal number (001–366): For
input, 366 is only valid in a leap year.
</p>
</dd>
<dt>
<code>%m</code>
</dt>
<dd>
<p>
Month as decimal number (01–12).
</p>
</dd>
<dt>
<code>%M</code>
</dt>
<dd>
<p>
Minute as decimal number (00–59).
</p>
</dd>
<dt>
<code>%n</code>
</dt>
<dd>
<p>
Newline on output, arbitrary whitespace on input.
</p>
</dd>
<dt>
<code>%p</code>
</dt>
<dd>
<p>
AM/PM indicator in the locale. Used in
conjunction with <code>%I</code> and <b>not</b> with <code>%H</code>. An
empty string in some locales (for example on some OSes,
non-English European locales including Russia). The behaviour is
undefined if used for input in such a locale.
</p>
<p>
Some platforms accept <code>%P</code> for output, which uses a lower-case
version (<code>%p</code> may also use lower case): others will output
<code>P</code>.
</p>
</dd>
<dt>
<code>%r</code>
</dt>
<dd>
<p>
For output, the 12-hour clock time (using the
locale’s AM or PM): only defined in some locales, and on some OSes
misleading in locales which do not define an AM/PM indicator.
For input, equivalent to <code>%I:%M:%S %p</code>.
</p>
</dd>
<dt>
<code>%R</code>
</dt>
<dd>
<p>
Equivalent to <code>%H:%M</code>.
</p>
</dd>
<dt>
<code>%S</code>
</dt>
<dd>
<p>
Second as integer (00–61), allowing for
up to two leap-seconds (but POSIX-compliant implementations
will ignore leap seconds).
</p>
</dd>
<dt>
<code>%t</code>
</dt>
<dd>
<p>
Tab on output, arbitrary whitespace on input.
</p>
</dd>
<dt>
<code>%T</code>
</dt>
<dd>
<p>
Equivalent to <code>%H:%M:%S</code>.
</p>
</dd>
<dt>
<code>%u</code>
</dt>
<dd>
<p>
Weekday as a decimal number (1–7, Monday is 1).
</p>
</dd>
</dl>
<dl>
<dt>
<code>%U</code>
</dt>
<dd>
<p>
Week of the year as decimal number (00–53) using
Sunday as the first day 1 of the week (and typically with the
first Sunday of the year as day 1 of week 1). The US convention.
</p>
</dd>
<dt>
<code>%V</code>
</dt>
<dd>
<p>
Week of the year as decimal number (01–53) as
defined in ISO 8601.
If the week (starting on Monday) containing 1 January has four or
more days in the new year, then it is considered week 1. Otherwise, it
is the last week of the previous year, and the next week is week
1. (Accepted but ignored on input.)
</p>
</dd>
<dt>
<code>%w</code>
</dt>
<dd>
<p>
Weekday as decimal number (0–6, Sunday is 0).
</p>
</dd>
<dt>
<code>%W</code>
</dt>
<dd>
<p>
Week of the year as decimal number (00–53) using
Monday as the first day of week (and typically with the
first Monday of the year as day 1 of week 1). The UK convention.
</p>
</dd>
<dt>
<code>%x</code>
</dt>
<dd>
<p>
Date. Locale-specific on output,
<code>“%y/%m/%d”</code> on input.
</p>
</dd>
<dt>
<code>%X</code>
</dt>
<dd>
<p>
Time. Locale-specific on output,
<code>“%H:%M:%S”</code> on input.
</p>
</dd>
<dt>
<code>%y</code>
</dt>
<dd>
<p>
Year without century (00–99). On input, values
00 to 68 are prefixed by 20 and 69 to 99 by 19 – that is the
behaviour specified by the 2018 POSIX standard, but it does
also say ‘it is expected that in a future version the
default century inferred from a 2-digit year will change’.
</p>
</dd>
<dt>
<code>%Y</code>
</dt>
<dd>
<p>
Year with century. Note that whereas there was no
zero in the original Gregorian calendar, ISO 8601:2004 defines it
to be valid (interpreted as 1BC): see
<a href="https://en.wikipedia.org/wiki/0_(year)">https://en.wikipedia.org/wiki/0_(year)</a>. However, the standards
also say that years before 1582 in its calendar should only be used
with agreement of the parties involved.
</p>
<p>
For input, only years <code>0:9999</code> are accepted.
</p>
</dd>
<dt>
<code>%z</code>
</dt>
<dd>
<p>
Signed offset in hours and minutes
from UTC, so <code>-0800</code> is 8 hours behind UTC. Values up to
<code>+1400</code> are accepted. (Standard only for output. For input
<span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> currently supports it on all platforms.)
</p>
</dd>
<dt>
<code>%Z</code>
</dt>
<dd>
<p>
(Output only.) Time zone abbreviation as a
character string (empty if not available). This may not be reliable
when a time zone has changed abbreviations over the years.
</p>
</dd>
</dl>
<p>
<p>Where leading zeros are shown they will be used on output but are
optional on input. Names are matched case-insensitively on input:
whether they are capitalized on output depends on the platform and the
locale. Note that abbreviated names are platform-specific (although
the standards specify that in the ‘<span class="samp">⁠C⁠</span>’ locale they must be the
first three letters of the capitalized English name: this convention
is widely used in English-language locales but for example the French
month abbreviations are not the same on any two of Linux, macOS, Solaris
and Windows). Knowing what the abbreviations are is essential
if you wish to use <code>%a</code>, <code>%b</code> or <code>%h</code> as part of an
input format: see the examples for how to check.</p>
</p>
<p>
When <code>%z</code> or <code>%Z</code> is used for output with an
object with an assigned time zone an attempt is made to use the values
for that time zone — but it is not guaranteed to succeed.
</p>
<p>
Not in the standards and less widely implemented are
</p>
<dl>
<dt>
<code>%k</code>
</dt>
<dd>
<p>
The 24-hour clock time with single digits preceded
by a blank.
</p>
</dd>
<dt>
<code>%l</code>
</dt>
<dd>
<p>
The 12-hour clock time with single digits preceded
by a blank.
</p>
</dd>
<dt>
<code>%s</code>
</dt>
<dd>
<p>
(Output only.) The number of seconds since the
epoch.
</p>
</dd>
<dt>
<code>%+</code>
</dt>
<dd>
<p>
(Output only.) Similar to <code>%c</code>, often
<code>“%a %b %e %H:%M:%S %Z %Y”</code>. May depend on the locale.
</p>
</dd>
</dl>
<p>
For output there are also <code>%O[dHImMUVwWy]</code> which may emit
numbers in an alternative locale-dependent format (e.g., roman
numerals), and <code>%E[cCyYxX]</code> which can use an alternative
‘era’ (e.g., a different religious calendar). Which of these
are supported is OS-dependent. These are accepted for input, but with
the standard interpretation.
</p>
<p>
Specific to <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> is <code>%OSn</code>, which for output gives the seconds
truncated to <code>0 &lt;= n &lt;= 6</code> decimal places (and if <code>%OS</code> is
not followed by a digit, it uses the setting of
<code>getOption(“digits.secs”)</code>, or if that is unset, <code>n =
0</code>). Further, for <code>strptime</code> <code>%OS</code> will input seconds
including fractional seconds. Note that <code>%S</code> does not read
fractional parts on output.
</p>
<p>
The behaviour of other conversion specifications (and even if other
character sequences commencing with <code>%</code> <em>are</em> conversion
specifications) is system-specific. Some systems document that the
use of multi-byte characters in <code>format</code> is unsupported: UTF-8
locales are unlikely to cause a problem.
</p>
<h3>
Value
</h3>
<p>
The <code>format</code> methods and <code>strftime</code> return character vectors
representing the time. <code>NA</code> times are returned as
<code>NA_character_</code>. The elements are restricted to 256 bytes, plus
a time zone abbreviation if <code>usetz</code> is true. (On known platforms
longer strings are truncated at 255 or 256 bytes, but this is not
guaranteed by the C99 standard.)
</p>
<p>
<code>strptime</code> turns character representations into an object of
class <code>“POSIXlt”</code>. The time zone is used to set the
<code>isdst</code> component and to set the <code>“tzone”</code> attribute if
<code>tz != ““</code>. If the specified time is invalid (for example
‘<span class="samp">⁠“2010-02-30 08:00”⁠</span>’) all the components of the result are
<code>NA</code>. (NB: this does means exactly what it says – if it is an
invalid time, not just a time that does not exist in some time zone.)
</p>
<h3>
Printing years
</h3>
<p>
Everyone agrees that years from 1000 to 9999 should be printed with 4
digits, but the standards do not define what is to be done outside
that range. For years 0 to 999 most OSes pad with zeros or spaces to
4 characters, and Linux outputs just the number.
</p>
<p>
OS facilities will probably not print years before 1 CE (aka 1 AD)
‘correctly’ (they tend to assume the existence of a year 0: see
<a href="https://en.wikipedia.org/wiki/0_(year)">https://en.wikipedia.org/wiki/0_(year)</a>, and some OSes get them
completely wrong). Common formats are <code>-45</code> and <code>-045</code>.
</p>
<p>
Years after 9999 and before -999 are normally printed with five or
more characters.
</p>
<p>
Some platforms support modifiers from POSIX 2008 (and others). On
Linux the format <code>“%04Y”</code> assures a minimum of four characters
and zero-padding. The internal code (as used on Windows and by
default on macOS) uses zero-padding by default, and formats
<code>%_4Y</code> and <code>%_Y</code> can be used for space padding and no
padding.
</p>
<h3>
Time zone offsets
</h3>
<p>
Offsets from GMT (also known as UTC) are part of the conversion
between timezones and to/from class <code>“POSIXct”</code>, but cause
difficulties as they are often computed incorrectly.
</p>
<p>
They conventionally have the opposite sign from time-zone
specifications (see <code>Sys.timezone</code>): positive values are
East of the meridian. Although there have been time zones with
offsets like 00:09:21 (Paris in 1900), and 00:44:30 (Liberia until
1972), offsets are usually treated as whole numbers of minutes, and
are most often seen in RFC 5322 email headers in forms like
<code>-0800</code> (e.g., used on the Pacific coast of the USA in winter).
</p>
<p>
Format <code>%z</code> can be used for input or output: it is a character
string, conventionally plus or minus followed by two digits for
hours and two for minutes: the standards say that an empty string
should be output if the offset is unknown, but some systems use the
offsets for the time zone in use for the current year.
</p>
<h3>
Sources
</h3>
<p>
Input uses the POSIX function <code>strptime</code> and output the C99
function <code>strftime</code>.
</p>
<p>
However, not all OSes (notably Windows) provided <code>strptime</code> and
many issues were found for those which did, so since 2000 <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> has used
a fork of code from ‘<span class="samp">⁠glibc⁠</span>’. The forked code uses the
system’s <code>strftime</code> to find the locale-specific day and month
names and any AM/PM indicator.
</p>
<p>
On some platforms (including Windows and by default on macOS) the
system’s <code>strftime</code> is replaced (along with most of the rest of
the C-level datetime code) by code modified from IANA’s ‘<span class="samp">⁠tzcode⁠</span>’
distribution (<a href="https://www.iana.org/time-zones">https://www.iana.org/time-zones</a>).
</p>
<h3>
Note
</h3>
<p>
The default formats follow the rules of the ISO 8601 international
standard which expresses a day as <code>“2001-02-28”</code> and a time as
<code>“14:01:02”</code> using leading zeroes as here. (The ISO form uses no
space to separate dates and times: <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> does by default.)
</p>
<p>
For <code>strptime</code> the input string need not specify the date
completely: it is assumed that unspecified seconds, minutes or hours
are zero, and an unspecified year, month or day is the current one.
(However, if a month is specified, the day of that month has to be
specified by <code>%d</code> or <code>%e</code> since the current day of the
month need not be valid for the specified month.) Some components may
be returned as <code>NA</code> (but an unknown <code>tzone</code> component is
represented by an empty string).
</p>
<p>
If the time zone specified is invalid on your system, what happens is
system-specific but it will probably be ignored.
</p>
<p>
Remember that in most time zones some times do not occur and some
occur twice because of transitions to/from ‘daylight saving’
(also known as ‘summer’) time. <code>strptime</code> does not
validate such times (it does not assume a specific time zone), but
conversion by <code>as.POSIXct</code> will do so. Conversion by
<code>strftime</code> and formatting/printing uses OS facilities and may
return nonsensical results for non-existent times at DST transitions.
</p>
<p>
In a C locale <code>%c</code> is required to be
<code>“%a %b %e %H:%M:%S %Y”</code>. As Windows does not comply (and
uses a date format not understood outside N. America), that format is
used by <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> on Windows in all locales.
</p>
<h3>
References
</h3>
<p>
International Organization for Standardization (2004, 2000, …)
‘ISO 8601. Data elements and interchange formats –
Information interchange – Representation of dates and times.’,
slightly updated to International Organization for Standardization (2019)
‘ISO 8601-1:2019. Date and time – Representations for
information interchange – Part 1: Basic rules’.
For links to versions available on-line see (at the time of writing)
<a href="https://dotat.at/tmp/ISO_8601-2004_E.pdf">https://dotat.at/tmp/ISO_8601-2004_E.pdf</a> and
<a href="https://www.qsl.net/g1smd/isopdf.htm">https://www.qsl.net/g1smd/isopdf.htm</a>; for information on the
current official version, see <a href="https://www.iso.org/iso/iso8601">https://www.iso.org/iso/iso8601</a> and
<a href="https://en.wikipedia.org/wiki/ISO_8601">https://en.wikipedia.org/wiki/ISO_8601</a>.
</p>
<p>
The POSIX 1003.1 standard, which is in some respects stricter than ISO 8601.
</p>
<h3>
See Also
</h3>
<p>
DateTimeClasses for details of the date-time classes;
locales to query or set a locale.
</p>
<p>
Your system’s help page on <code>strftime</code> to see how to specify their
formats. (On some systems, including Windows, <code>strftime</code> is
replaced by more comprehensive internal code.)
</p>
<h3>
Examples
</h3>
<pre class="r"><code class='language-R'>
## locale-specific version of date()
format(Sys.time(), "%a %b %d %X %Y %Z")

## time to sub-second accuracy (if supported by the OS)
format(Sys.time(), "%H:%M:%OS3")

## read in date info in format 'ddmmmyyyy'
## This will give NA(s) in some non-English locales; setting the C locale
## as in the commented lines will overcome this on most systems.
## lct &lt;- Sys.getlocale("LC_TIME"); Sys.setlocale("LC_TIME", "C")
x &lt;- c("1jan1960", "2jan1960", "31mar1960", "30jul1960")
z &lt;- strptime(x, "%d%b%Y")
## Sys.setlocale("LC_TIME", lct)
z

## read in date/time info in format 'm/d/y h:m:s'
dates &lt;- c("02/27/92", "02/27/92", "01/14/92", "02/28/92", "02/01/92")
times &lt;- c("23:03:20", "22:29:56", "01:03:30", "18:21:03", "16:56:26")
x &lt;- paste(dates, times)
strptime(x, "%m/%d/%y %H:%M:%S")

## time with fractional seconds
z &lt;- strptime("20/2/06 11:16:16.683", "%d/%m/%y %H:%M:%OS")
z # prints without fractional seconds
op &lt;- options(digits.secs = 3)
z
options(op)

## time zone names are not portable, but 'EST5EDT' comes pretty close.
(x &lt;- strptime(c("2006-01-08 10:07:52", "2006-08-07 19:33:02"),
               "%Y-%m-%d %H:%M:%S", tz = "EST5EDT"))
attr(x, "tzone")

## An RFC 5322 header (Eastern Canada, during DST)
## In a non-English locale the commented lines may be needed.
## prev &lt;- Sys.getlocale("LC_TIME"); Sys.setlocale("LC_TIME", "C")
strptime("Tue, 23 Mar 2010 14:36:38 -0400", "%a, %d %b %Y %H:%M:%S %z")
## Sys.setlocale("LC_TIME", prev)

## Make sure you know what the abbreviated names are for you if you wish
## to use them for input (they are matched case-insensitively):
format(seq.Date(as.Date('1978-01-01'), by = 'day', len = 7), "%a")
format(seq.Date(as.Date('2000-01-01'), by = 'month', len = 12), "%b")

format(.POSIXct(Inf)) # "Inf"  (was  NA  in R &lt;= 4.1.x)
notF &lt;- c(-Inf,Inf,NaN,NA)
(fF &lt;- format(.POSIXct(notF))) # was all  NA, now the last is still NA (not "NA")
stopifnot(identical(as.character(notF), fF))
</code></pre>
</div>
</div>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="data-manipulation-wity-tidyverse.html#cb400-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">strptime</span>(t, <span class="st">&quot;%Y-%m-%dT%H:%M:%SZ&quot;</span>)</span>
<span id="cb400-2"><a href="data-manipulation-wity-tidyverse.html#cb400-2" aria-hidden="true" tabindex="-1"></a>raw <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code></pre></div>
<pre class="output"><code>## Rows: 8,317
## Columns: 7
## $ plink    &lt;chr&gt; &quot;https://www.ptt.cc/bbs/HatePolitics/M.1555035677.A.24B.html&quot;…
## $ board    &lt;chr&gt; &quot;HatePolitics&quot;, &quot;HatePolitics&quot;, &quot;HatePolitics&quot;, &quot;HatePolitics…
## $ pcontent &lt;chr&gt; &quot;\n\n韓國瑜赴哈佛大學前受訪表示，就是「keeping practice」，盡…
## $ poster   &lt;chr&gt; &quot;lovebxcx&quot;, &quot;ikr3699654&quot;, &quot;sunyeah&quot;, &quot;rock720429&quot;, &quot;btm978952…
## $ ptitle   &lt;chr&gt; &quot;Re: [新聞] 重申反對一國兩制　韓國瑜：看著我靈魂深&quot;, &quot;Re: [討…
## $ ptime    &lt;dttm&gt; 2019-04-12 02:21:14, 2019-04-12 02:13:45, 2019-04-12 02:10:1…
## $ ipaddr   &lt;chr&gt; &quot;83.221.204.163&quot;, &quot;114.43.176.110&quot;, &quot;118.163.130.181&quot;, &quot;118.1…</code></pre>
</div>
<div id="時間作為機率分佈x軸" class="section level3 hasAnchor" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> 時間作為機率分佈X軸<a href="data-manipulation-wity-tidyverse.html#時間作為機率分佈x軸" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="data-manipulation-wity-tidyverse.html#cb402-1" aria-hidden="true" tabindex="-1"></a>raw <span class="sc">%&gt;%</span></span>
<span id="cb402-2"><a href="data-manipulation-wity-tidyverse.html#cb402-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(ptime) <span class="sc">+</span> </span>
<span id="cb402-3"><a href="data-manipulation-wity-tidyverse.html#cb402-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="R-for-Data-Journalism_files/figure-html/unnamed-chunk-126-1.png" width="672" /></p>
</div>
<div id="逐月統計資料" class="section level3 hasAnchor" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> 逐月統計資料<a href="data-manipulation-wity-tidyverse.html#逐月統計資料" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="data-manipulation-wity-tidyverse.html#cb403-1" aria-hidden="true" tabindex="-1"></a>?lubridate</span></code></pre></div>
<div class="r-help-page">
<div class="container">
<table style="width: 100%;">
<tr>
<td>
lubridate-package
</td>
<td style="text-align: right;">
R Documentation
</td>
</tr>
</table>
<h2>
Dates and times made easy with lubridate
</h2>
<h3>
Description
</h3>
<p>
Lubridate provides tools that make it easier to parse and
manipulate dates. These tools are grouped below by common
purpose. More information about each function can be found in
its help documentation.
</p>
<h3>
Parsing dates
</h3>
<p>
Lubridate’s parsing functions read strings into R as POSIXct
date-time objects. Users should choose the function whose name
models the order in which the year (‘y’), month (‘m’) and day
(‘d’) elements appear the string to be parsed:
<code>dmy()</code>, <code>myd()</code>, <code>ymd()</code>,
<code>ydm()</code>, <code>dym()</code>, <code>mdy()</code>,
<code>ymd_hms()</code>). A very flexible and user friendly parser
is provided by <code>parse_date_time()</code>.
</p>
<p>
Lubridate can also parse partial dates from strings into
Period objects with the functions
<code>hm()</code>, <code>hms()</code> and <code>ms()</code>.
</p>
<p>
Lubridate has an inbuilt very fast POSIX parser. Most of the <code>strptime()</code>
formats and various extensions are supported for English locales. See
<code>parse_date_time()</code> for more details.
</p>
<h3>
Manipulating dates
</h3>
<p>
Lubridate distinguishes between moments in time (known as
<code>instants()</code>) and spans of time (known as time spans, see
Timespan). Time spans are further separated into
Duration, Period and
Interval objects.
</p>
<h3>
Instants
</h3>
<p>
Instants are specific moments of time. Date, POSIXct, and
POSIXlt are the three object classes Base R recognizes as
instants. <code>is.Date()</code> tests whether an object
inherits from the Date class. <code>is.POSIXt()</code> tests
whether an object inherits from the POSIXlt or POSIXct classes.
<code>is.instant()</code> tests whether an object inherits from
any of the three classes.
</p>
<p>
<code>now()</code> returns the current system time as a POSIXct
object. <code>today()</code> returns the current system date.
For convenience, 1970-01-01 00:00:00 is saved to
origin. This is the instant from which POSIXct
times are calculated. Try <code>unclass(now())</code> to see the numeric structure that
underlies POSIXct objects. Each POSIXct object is saved as the number of seconds
it occurred after 1970-01-01 00:00:00.
</p>
<p>
Conceptually, instants are a combination of measurements on different units
(i.e, years, months, days, etc.). The individual values for
these units can be extracted from an instant and set with the
accessor functions <code>second()</code>, <code>minute()</code>,
<code>hour()</code>, <code>day()</code>, <code>yday()</code>,
<code>mday()</code>, <code>wday()</code>, <code>week()</code>,
<code>month()</code>, <code>year()</code>, <code>tz()</code>,
and <code>dst()</code>.
Note: the accessor functions are named after the singular form
of an element. They shouldn’t be confused with the period
helper functions that have the plural form of the units as a
name (e.g, <code>seconds()</code>).
</p>
<h3>
Rounding dates
</h3>
<p>
Instants can be rounded to a convenient unit using the
functions <code>ceiling_date()</code>, <code>floor_date()</code>
and <code>round_date()</code>.
</p>
<h3>
Time zones
</h3>
<p>
Lubridate provides two helper functions for working with time
zones. <code>with_tz()</code> changes the time zone in which an
instant is displayed. The clock time displayed for the instant
changes, but the moment of time described remains the same.
<code>force_tz()</code> changes only the time zone element of an
instant. The clock time displayed remains the same, but the
resulting instant describes a new moment of time.
</p>
<h3>
Timespans
</h3>
<p>
A timespan is a length of time that may or may not be connected to
a particular instant. For example, three months is a timespan. So is an hour and
a half. Base R uses difftime class objects to record timespans.
However, people are not always consistent in how they expect time to behave.
Sometimes the passage of time is a monotone progression of instants that should
be as mathematically reliable as the number line. On other occasions time must
follow complex conventions and rules so that the clock times we see reflect what
we expect to observe in terms of daylight, season, and congruence with the
atomic clock. To better navigate the nuances of time, <span class="pkg">lubridate</span> creates three
additional timespan classes, each with its own specific and consistent behavior:
Interval, Period and
Duration.
</p>
<p>
<code>is.difftime()</code> tests whether an object
inherits from the difftime class. <code>is.timespan()</code>
tests whether an object inherits from any of the four timespan
classes.
</p>
<h3>
Durations
</h3>
<p>
Durations measure the exact amount of time that occurs between two
instants. This can create unexpected results in relation to clock times if a
leap second, leap year, or change in daylight savings time (DST) occurs in
the interval.
</p>
<p>
Functions for working with durations include <code>is.duration()</code>,
<code>as.duration()</code> and <code>duration()</code>. <code>dseconds()</code>,
<code>dminutes()</code>, <code>dhours()</code>, <code>ddays()</code>,
<code>dweeks()</code> and <code>dyears()</code> convenient lengths.
</p>
<h3>
Periods
</h3>
<p>
Periods measure the change in clock time that occurs between two
instants. Periods provide robust predictions of clock time in the presence of
leap seconds, leap years, and changes in DST.
</p>
<p>
Functions for working with periods include
<code>is.period()</code>, <code>as.period()</code> and
<code>period()</code>. <code>seconds()</code>,
<code>minutes()</code>, <code>hours()</code>, <code>days()</code>,
<code>weeks()</code>, <code>months()</code> and
<code>years()</code> quickly create periods of convenient
lengths.
</p>
<h3>
Intervals
</h3>
<p>
Intervals are timespans that begin at a specific instant and
end at a specific instant. Intervals retain complete information about a
timespan. They provide the only reliable way to convert between
periods and durations.
</p>
<p>
Functions for working with intervals include
<code>is.interval()</code>, <code>as.interval()</code>,
<code>interval()</code>, <code>int_shift()</code>,
<code>int_flip()</code>, <code>int_aligns()</code>,
<code>int_overlaps()</code>, and
<code>%within%</code>. Intervals can also be manipulated with
intersect, union, and setdiff().
</p>
<h3>
Miscellaneous
</h3>
<p>
<code>decimal_date()</code> converts an instant to a decimal of
its year.
<code>leap_year()</code> tests whether an instant occurs during
a leap year.
<code>pretty_dates()</code> provides a method of making pretty
breaks for date-times.
lakers is a data set that contains information
about the Los Angeles Lakers 2008-2009 basketball season.
</p>
<h3>
Author(s)
</h3>
<p>
<strong>Maintainer</strong>: Vitalie Spinu <a href="mailto:spinuvit@gmail.com">spinuvit@gmail.com</a>
</p>
<p>
Authors:
</p>
<ul>
<li>
<p>
Garrett Grolemund
</p>
</li>
<li>
<p>
Hadley Wickham
</p>
</li>
</ul>
<p>
Other contributors:
</p>
<ul>
<li>
<p>
Davis Vaughan [contributor]
</p>
</li>
<li>
<p>
Ian Lyttle [contributor]
</p>
</li>
<li>
<p>
Imanuel Costigan [contributor]
</p>
</li>
<li>
<p>
Jason Law [contributor]
</p>
</li>
<li>
<p>
Doug Mitarotonda [contributor]
</p>
</li>
<li>
<p>
Joseph Larmarange [contributor]
</p>
</li>
<li>
<p>
Jonathan Boiser [contributor]
</p>
</li>
<li>
<p>
Chel Hee Lee [contributor]
</p>
</li>
<li>
<p>
Google Inc. [contributor, copyright holder]
</p>
</li>
</ul>
<h3>
References
</h3>
<p>
Garrett Grolemund, Hadley Wickham (2011). Dates and Times Made
Easy with lubridate. Journal of Statistical Software, 40(3), 1-25.
<a href="https://www.jstatsoft.org/v40/i03/">https://www.jstatsoft.org/v40/i03/</a>.
</p>
<h3>
See Also
</h3>
<p>
Useful links:
</p>
<ul>
<li>
<p>
<a href="https://lubridate.tidyverse.org">https://lubridate.tidyverse.org</a>
</p>
</li>
<li>
<p>
<a href="https://github.com/tidyverse/lubridate">https://github.com/tidyverse/lubridate</a>
</p>
</li>
<li>
<p>
Report bugs at <a href="https://github.com/tidyverse/lubridate/issues">https://github.com/tidyverse/lubridate/issues</a>
</p>
</li>
</ul>
</div>
</div>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="data-manipulation-wity-tidyverse.html#cb404-1" aria-hidden="true" tabindex="-1"></a>raw <span class="sc">%&gt;%</span></span>
<span id="cb404-2"><a href="data-manipulation-wity-tidyverse.html#cb404-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">m =</span> <span class="fu">month</span>(ptime)) <span class="sc">%&gt;%</span> </span>
<span id="cb404-3"><a href="data-manipulation-wity-tidyverse.html#cb404-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(m) <span class="sc">%&gt;%</span></span>
<span id="cb404-4"><a href="data-manipulation-wity-tidyverse.html#cb404-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(m, n) <span class="sc">+</span> </span>
<span id="cb404-5"><a href="data-manipulation-wity-tidyverse.html#cb404-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>()</span></code></pre></div>
<p><img src="R-for-Data-Journalism_files/figure-html/unnamed-chunk-127-1.png" width="672" /></p>
</div>
<div id="逐日統計資料佳" class="section level3 hasAnchor" number="6.4.4">
<h3><span class="header-section-number">6.4.4</span> 逐日統計資料（佳）<a href="data-manipulation-wity-tidyverse.html#逐日統計資料佳" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="data-manipulation-wity-tidyverse.html#cb405-1" aria-hidden="true" tabindex="-1"></a>raw <span class="sc">%&gt;%</span></span>
<span id="cb405-2"><a href="data-manipulation-wity-tidyverse.html#cb405-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ptime <span class="sc">&gt;=</span> <span class="fu">as_date</span>(<span class="st">&quot;2019-03-18&quot;</span>) <span class="sc">&amp;</span> ptime <span class="sc">&lt;</span> <span class="fu">as_date</span>(<span class="st">&quot;2019-04-01&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb405-3"><a href="data-manipulation-wity-tidyverse.html#cb405-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">m =</span> <span class="fu">floor_date</span>(ptime, <span class="at">unit =</span> <span class="st">&quot;day&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb405-4"><a href="data-manipulation-wity-tidyverse.html#cb405-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(m) <span class="sc">%&gt;%</span></span>
<span id="cb405-5"><a href="data-manipulation-wity-tidyverse.html#cb405-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(m, n) <span class="sc">+</span> </span>
<span id="cb405-6"><a href="data-manipulation-wity-tidyverse.html#cb405-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>()</span></code></pre></div>
<p><img src="R-for-Data-Journalism_files/figure-html/unnamed-chunk-128-1.png" width="672" /></p>
</div>
<div id="每日逐時資料" class="section level3 hasAnchor" number="6.4.5">
<h3><span class="header-section-number">6.4.5</span> 每日逐時資料<a href="data-manipulation-wity-tidyverse.html#每日逐時資料" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="data-manipulation-wity-tidyverse.html#cb406-1" aria-hidden="true" tabindex="-1"></a>clean <span class="sc">%&gt;%</span></span>
<span id="cb406-2"><a href="data-manipulation-wity-tidyverse.html#cb406-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ptime <span class="sc">&gt;=</span> <span class="fu">as_datetime</span>(<span class="st">&quot;2019-03-25&quot;</span>) <span class="sc">&amp;</span> ptime <span class="sc">&lt;</span> <span class="fu">as_datetime</span>(<span class="st">&quot;2019-04-01&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb406-3"><a href="data-manipulation-wity-tidyverse.html#cb406-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">d =</span> <span class="fu">floor_date</span>(ptime, <span class="at">unit =</span> <span class="st">&quot;day&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb406-4"><a href="data-manipulation-wity-tidyverse.html#cb406-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">h =</span> <span class="fu">hour</span>(ptime)) <span class="sc">%&gt;%</span></span>
<span id="cb406-5"><a href="data-manipulation-wity-tidyverse.html#cb406-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(d, h) <span class="sc">%&gt;%</span></span>
<span id="cb406-6"><a href="data-manipulation-wity-tidyverse.html#cb406-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">wd =</span> <span class="fu">wday</span>(d, <span class="at">label =</span> F, <span class="at">locale =</span> <span class="fu">Sys.getlocale</span>(<span class="st">&quot;LC_TIME&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb406-7"><a href="data-manipulation-wity-tidyverse.html#cb406-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">isweekend =</span> <span class="fu">ifelse</span>(wd <span class="sc">&gt;=</span> <span class="dv">6</span>, <span class="st">&quot;weekend&quot;</span>, <span class="st">&quot;weekday&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb406-8"><a href="data-manipulation-wity-tidyverse.html#cb406-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(h, n, <span class="at">color =</span> <span class="fu">as.character</span>(d)) <span class="sc">+</span> </span>
<span id="cb406-9"><a href="data-manipulation-wity-tidyverse.html#cb406-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb406-10"><a href="data-manipulation-wity-tidyverse.html#cb406-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>isweekend)</span></code></pre></div>
<p><img src="R-for-Data-Journalism_files/figure-html/unnamed-chunk-129-1.png" width="672" /></p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="data-manipulation-wity-tidyverse.html#cb407-1" aria-hidden="true" tabindex="-1"></a>?ifelse</span></code></pre></div>
<pre class="output"><code>## Help on topic &#39;ifelse&#39; was found in the following packages:
## 
##   * base
##   * data.table</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="使用基礎r套件.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="text-processing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/R30-Data-Manipulation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R for Data Journalism.pdf", "R for Data Journalism.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
