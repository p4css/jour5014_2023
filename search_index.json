[["data-manipulation-wity-tidyverse.html", "Chapter 5 Data Manipulation wity tidyverse", " Chapter 5 Data Manipulation wity tidyverse "],["base-to-dplyr-tp-theft.html", "5.1 base to dplyr: TP Theft", " 5.1 base to dplyr: TP Theft library(tidyverse) # options(stringsAsFactors = F) # default options in R ver.&gt; 4.0 5.1.1 Reading data # Read by read_csv() # Will raise error # Error in make.names(x) : invalid multibyte string at &#39;&lt;bd&gt;s&lt;b8&gt;&lt;b9&gt;&#39; # df &lt;- read_csv(&quot;data/tp_theft.csv&quot;) # read_csv() with locale = locale(encoding = &quot;Big5&quot;) library(readr) df &lt;- read_csv(&quot;data/臺北市住宅竊盜點位資訊-UTF8-BOM-1.csv&quot;) 5.1.2 Cleaning data I Renaming variables by select() Generating variable year Generating variable month Retrieving area selected_df &lt;- df %&gt;% select(id = 編號, cat = 案類, date = `發生日期`, time = `發生時段`, location = `發生地點`) %&gt;% mutate(year = date %/% 10000) %&gt;% mutate(month = date %/% 100 %% 100) %&gt;% mutate(area = stringr::str_sub(location, 4, 6)) %&gt;% mutate(county = stringr::str_sub(location, 1, 3)) 5.1.3 Cleaning data II Filtering out irrelevant data records # readr::guess_encoding(&quot;data/tp_theft.csv&quot;) filtered_df &lt;- selected_df %&gt;% # count(year) %&gt;% View filter(county == &quot;臺北市&quot;) %&gt;% filter(year &gt;= 104) %&gt;% # count(time) %&gt;% View # count(location) %&gt;% filter(!area %in% c(&quot;中和市&quot;, &quot;板橋市&quot;)) 5.1.4 Long to wide form count() two variables spread() spread one variable as columns to wide form # count() then spread() df.wide &lt;- filtered_df %&gt;% count(time, area) %&gt;% spread(area, n, fill=0) 5.1.5 Setting time as row.name for mosaicplot row.names(df.wide) &lt;- df.wide$time df.wide$time &lt;- NULL # Specify fonts for Chinese # par(family=(&#39;STKaiti&#39;)) par(family=(&#39;Heiti TC Light&#39;)) # for mac # Specify colors colors &lt;- c(&#39;#D0104C&#39;, &#39;#DB4D6D&#39;, &#39;#E83015&#39;, &#39;#F75C2F&#39;, &#39;#E79460&#39;, &#39;#E98B2A&#39;, &#39;#9B6E23&#39;, &#39;#F7C242&#39;, &#39;#BEC23F&#39;, &#39;#90B44B&#39;, &#39;#66BAB7&#39;, &#39;#1E88A8&#39;) # mosaicplot() mosaicplot(df.wide, color=colors, border=0, off = 3, main=&quot;Theft rate of Taipei city (region by hour)&quot;) 5.1.6 Clean version library(readr) # options(stringsAsFactors = F) df &lt;- read_csv(&quot;data/臺北市住宅竊盜點位資訊-UTF8-BOM-1.csv&quot;) selected_df &lt;- df %&gt;% select(id = 編號, cat = 案類, date = `發生日期`, time = `發生時段`, location = `發生地點`) %&gt;% mutate(year = date %/% 10000) %&gt;% mutate(month = date %/% 100 %% 100) %&gt;% mutate(area = stringr::str_sub(location, 4, 6)) %&gt;% mutate(county = stringr::str_sub(location, 1, 3)) selected_df %&gt;% count(year) year n 103 1 104 687 105 663 106 560 107 501 108 411 109 304 110 189 111 31 selected_df %&gt;% count(time) %&gt;% head(10) time n 00~02 272 02~04 214 03~05 8 04~06 156 05~07 23 06~08 191 08~10 305 09~11 6 10~12 338 11~03 1 selected_df %&gt;% arrange(time) %&gt;% head(10) id cat date time location year month area county 2 住宅竊盜 1040101 00~02 臺北市文山區萬美里萬寧街1~30號 104 1 文山區 臺北市 3 住宅竊盜 1040101 00~02 臺北市信義區富台里忠孝東路5段295巷6弄1~30號 104 1 信義區 臺北市 6 住宅竊盜 1040102 00~02 臺北市士林區天福里1鄰忠誠路2段130巷1~30號 104 1 士林區 臺北市 12 住宅竊盜 1040105 00~02 臺北市中山區南京東路3段181~210號 104 1 中山區 臺北市 33 住宅竊盜 1040115 00~02 臺北市松山區饒河街181~210號 104 1 松山區 臺北市 74 住宅竊盜 1040131 00~02 臺北市南港區重陽路57巷1~30號 104 1 南港區 臺北市 75 住宅竊盜 1040201 00~02 臺北市北投區中心里中和街31~60號 104 2 北投區 臺北市 92 住宅竊盜 1040210 00~02 臺北市北投區大同路200巷1~30號 104 2 北投區 臺北市 95 住宅竊盜 1040212 00~02 臺北市萬華區萬大路493巷48弄1~30號 104 2 萬華區 臺北市 106 住宅竊盜 1040216 00~02 臺北市信義區吳興街269巷1~30號 104 2 信義區 臺北市 filtered_df &lt;- selected_df %&gt;% # count(year) %&gt;% View filter(year &gt;= 104) %&gt;% filter(!time %in% c(&quot;03~05&quot;, &quot;05~07&quot;, &quot;09~11&quot;, &quot;11~13&quot;, &quot;15~17&quot;, &quot;17~19&quot;, &quot;18~21&quot;, &quot;21~23&quot;, &quot;23~01&quot;)) # count(time) %&gt;% View # count(location) %&gt;% # filter(!area %in% c(&quot;中和市&quot;, &quot;板橋市&quot;)) df.wide &lt;- filtered_df %&gt;% count(time, area) %&gt;% spread(area, n, fill=0) %&gt;% as.data.frame() row.names(df.wide) &lt;- df.wide$time df.wide$time &lt;- NULL par(family=(&#39;Heiti TC Light&#39;)) # for mac # Specify colors colors &lt;- c(&#39;#D0104C&#39;, &#39;#DB4D6D&#39;, &#39;#E83015&#39;, &#39;#F75C2F&#39;, &#39;#E79460&#39;, &#39;#E98B2A&#39;, &#39;#9B6E23&#39;, &#39;#F7C242&#39;, &#39;#BEC23F&#39;, &#39;#90B44B&#39;, &#39;#66BAB7&#39;, &#39;#1E88A8&#39;) # mosaicplot() mosaicplot(df.wide, color=colors, border=0, off = 3, main=&quot;Theft rate of Taipei city (region by hour)&quot;) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
